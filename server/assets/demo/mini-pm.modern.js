import{strFromU8 as e,zlibSync as t,strToU8 as n}from"fflate";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var r;!function(e){e[e.URGENT=1]="URGENT",e[e.IDLE=2]="IDLE"}(r||(r={}));const s=window,a=s.performance,i=s.navigator,l=s.console,c=document,u=(e,...t)=>l.log("mini-pmðŸ¢ï¼š",e,...t),d=(e,...t)=>l.warn("mini-pmðŸ¢ï¼š",e,...t),m={isObserverResourceTiming:!1,isObserverElementTiming:!1,maxTime:15e3,captureError:!0,reportData:void 0,analyticsTracker:e=>{u(e)},recordOptions:{},fetchDomain:"",errLogRoute:"",errEventRoute:"",logRoute:""};var p;function h(e){const t=null==e?void 0:e.host;return Boolean(t&&t.shadowRoot&&t.shadowRoot===e)}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(p||(p={}));let f=1;const g=RegExp("[^a-z0-9-_]");function v(e){try{const t=e.rules||e.cssRules;return t?Array.from(t).map(b).join(""):null}catch(e){return null}}function b(e){return function(e){return"styleSheet"in e}(e)?v(e.styleSheet)||"":e.cssText}const y=/url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm,k=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,S=/^(data:)([^,]*),(.*)/i;function C(e,t){return(e||"").replace(y,(e,n,o,r,s,a)=>{const i=o||s||a,l=n||r||"";if(!i)return e;if(!k.test(i))return`url(${l}${i}${l})`;if(S.test(i))return`url(${l}${i}${l})`;if("/"===i[0])return`url(${l}${function(e){let t;return t=e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0],t=t.split("?")[0],t}(t)+i}${l})`;const c=t.split("/"),u=i.split("/");c.pop();for(const e of u)"."!==e&&(".."===e?c.pop():c.push(e));return`url(${l}${c.join("/")}${l})`})}const w=/^[^ \t\n\r\u000c]+/,T=/^[, \t\n\r\u000c]+/;function E(e,t){if(!t||""===t.trim())return t;const n=e.createElement("a");return n.href=t,n.href}function x(){const e=document.createElement("a");return e.href="",e.href}function O(e,t,n,o){return"src"===n||("href"===n||"xlink:href"===n)&&o?E(e,o):"background"!==n||!o||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n&&o?function(e,t){if(""===t.trim())return t;let n=0;function o(e){var o,r=e.exec(t.substring(n));return r?(n+=(o=r[0]).length,o):""}let r=[];for(;o(T),!(n>=t.length);){let s=o(w);if(","===s.slice(-1))s=E(e,s.substring(0,s.length-1)),r.push(s);else{let o="";s=E(e,s);let a=!1;for(;;){let e=t.charAt(n);if(""===e){r.push((s+o).trim());break}if(a)")"===e&&(a=!1);else{if(","===e){n+=1,r.push((s+o).trim());break}"("===e&&(a=!0)}o+=e,n+=1}}}return r.join(", ")}(e,o):"style"===n&&o?C(o,x()):o:E(e,o)}function N(e,t,n){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){if("string"==typeof t){if(e.classList.contains(t))return!0}else e.classList.forEach(e=>{if(t.test(e))return!0});return!(!n||!e.matches(n))||N(e.parentNode,t,n)}return N(e.parentNode,t,n)}function I(e){return void 0===e?"":e.toLowerCase()}function M(e,t){const{doc:n,map:o,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:l=!1,inlineStylesheet:c=!0,maskInputOptions:u={},maskTextFn:d,slimDOMOptions:m,recordCanvas:b=!1,onSerialize:y,onIframeLoad:k,iframeLoadTimeout:S=5e3}=t;let{preserveWhiteSpace:w=!0}=t;const T=function(e,t){const{doc:n,blockClass:o,blockSelector:r,maskTextClass:s,maskTextSelector:a,inlineStylesheet:i,maskInputOptions:l={},maskTextFn:c,recordCanvas:u}=t;let d;if(n.__sn){const e=n.__sn.id;d=1===e?void 0:e}switch(e.nodeType){case e.DOCUMENT_NODE:return{type:p.Document,childNodes:[],rootId:d};case e.DOCUMENT_TYPE_NODE:return{type:p.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:d};case e.ELEMENT_NODE:const t=function(e,t,n){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(let n=0;n<e.classList.length;n++)if(t.test(e.classList[n]))return!0;return!!n&&e.matches(n)}(e,o,r),h=function(e){if(e instanceof HTMLFormElement)return"form";const t=e.tagName.toLowerCase().trim();return g.test(t)?"div":t}(e);let f={};for(const{name:t,value:o}of Array.from(e.attributes))f[t]=O(n,h,t,o);if("link"===h&&i){const t=Array.from(n.styleSheets).find(t=>t.href===e.href),o=v(t);o&&(delete f.rel,delete f.href,f._cssText=C(o,t.href))}if("style"===h&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const t=v(e.sheet);t&&(f._cssText=C(t,x()))}if("input"===h||"textarea"===h||"select"===h){const t=e.value;"radio"!==f.type&&"checkbox"!==f.type&&"submit"!==f.type&&"button"!==f.type&&t?f.value=l[f.type]||l[h]?"*".repeat(t.length):t:e.checked&&(f.checked=e.checked)}if("option"===h&&f.value===e.parentElement.value&&(f.selected=e.selected),"canvas"===h&&u&&(f.rr_dataURL=e.toDataURL()),"audio"!==h&&"video"!==h||(f.rr_mediaState=e.paused?"paused":"played"),e.scrollLeft&&(f.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(f.rr_scrollTop=e.scrollTop),t){const{width:t,height:n}=e.getBoundingClientRect();f={class:f.class,rr_width:`${t}px`,rr_height:`${n}px`}}return"iframe"===h&&delete f.src,{type:p.Element,tagName:h,attributes:f,childNodes:[],isSVG:(m=e,"svg"===m.tagName||m instanceof SVGElement||void 0),needBlock:t,rootId:d};case e.TEXT_NODE:const b=e.parentNode&&e.parentNode.tagName;let y=e.textContent;const k="STYLE"===b||void 0,S="SCRIPT"===b||void 0;return k&&y&&(y=C(y,x())),S&&(y="SCRIPT_PLACEHOLDER"),!k&&!S&&N(e,s,a)&&y&&(y=c?c(y):y.replace(/[\S]/g,"*")),{type:p.Text,textContent:y||"",isStyle:k,rootId:d};case e.CDATA_SECTION_NODE:return{type:p.CDATA,textContent:"",rootId:d};case e.COMMENT_NODE:return{type:p.Comment,textContent:e.textContent||"",rootId:d};default:return!1}var m}(e,{doc:n,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,inlineStylesheet:c,maskInputOptions:u,maskTextFn:d,recordCanvas:b});if(!T)return console.warn(e,"not serialized"),null;let E;E="__sn"in e?e.__sn.id:!function(e,t){if(t.comment&&e.type===p.Comment)return!0;if(e.type===p.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(I(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===I(e.attributes.name)||"icon"===I(e.attributes.rel)||"apple-touch-icon"===I(e.attributes.rel)||"shortcut icon"===I(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&I(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(I(e.attributes.property).match(/^(og|twitter|fb):/)||I(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===I(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===I(e.attributes.name)||"googlebot"===I(e.attributes.name)||"bingbot"===I(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===I(e.attributes.name)||"generator"===I(e.attributes.name)||"framework"===I(e.attributes.name)||"publisher"===I(e.attributes.name)||"progid"===I(e.attributes.name)||I(e.attributes.property).match(/^article:/)||I(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===I(e.attributes.name)||"yandex-verification"===I(e.attributes.name)||"csrf-token"===I(e.attributes.name)||"p:domain_verify"===I(e.attributes.name)||"verify-v1"===I(e.attributes.name)||"verification"===I(e.attributes.name)||"shopify-checkout-api-token"===I(e.attributes.name)))return!0}}return!1}(T,m)&&(w||T.type!==p.Text||T.isStyle||T.textContent.replace(/^\s+|\s+$/gm,"").length)?f++:-2;const L=Object.assign(T,{id:E});if(e.__sn=L,-2===E)return null;o[E]=e,y&&y(e);let D=!l;if(L.type===p.Element&&(D=D&&!L.needBlock,delete L.needBlock),(L.type===p.Document||L.type===p.Element)&&D){m.headWhitespace&&T.type===p.Element&&"head"===T.tagName&&(w=!1);const t={doc:n,map:o,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:l,inlineStylesheet:c,maskInputOptions:u,maskTextFn:d,slimDOMOptions:m,recordCanvas:b,preserveWhiteSpace:w,onSerialize:y,onIframeLoad:k,iframeLoadTimeout:S};for(const n of Array.from(e.childNodes)){const e=M(n,t);e&&L.childNodes.push(e)}if(function(e){return e.nodeType===e.ELEMENT_NODE}(e)&&e.shadowRoot){L.isShadowHost=!0;for(const n of Array.from(e.shadowRoot.childNodes)){const e=M(n,t);e&&(e.isShadow=!0,L.childNodes.push(e))}}}return e.parentNode&&h(e.parentNode)&&(L.isShadow=!0),L.type===p.Element&&"iframe"===L.tagName&&function(e,t,n){const o=e.contentWindow;if(!o)return;let r,s=!1;try{r=o.document.readyState}catch(e){return}if("complete"!==r){const o=setTimeout(()=>{s||(t(),s=!0)},n);return void e.addEventListener("load",()=>{clearTimeout(o),s=!0,t()})}const a="about:blank";o.location.href===a&&e.src!==a&&""!==e.src?e.addEventListener("load",t):t()}(e,()=>{const t=e.contentDocument;if(t&&k){const n=M(t,{doc:t,map:o,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:!1,inlineStylesheet:c,maskInputOptions:u,maskTextFn:d,slimDOMOptions:m,recordCanvas:b,preserveWhiteSpace:w,onSerialize:y,onIframeLoad:k,iframeLoadTimeout:S});n&&k(e,n)}},S),L}var L,D,_,R;function F(e,t,n=document){const o={capture:!0,passive:!0};return n.addEventListener(e,t,o),()=>n.removeEventListener(e,t,o)}!function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom"}(L||(L={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag"}(D||(D={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd"}(_||(_={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"}(R||(R={}));const z="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let A={map:{},getId:()=>(console.error(z),-1),getNode:()=>(console.error(z),null),removeNodeFromMap(){console.error(z)},has:()=>(console.error(z),!1),reset(){console.error(z)}};function $(e,t,n={}){let o=null,r=0;return function(s){let a=Date.now();r||!1!==n.leading||(r=a);let i=t-(a-r),l=this,c=arguments;i<=0||i>t?(o&&(window.clearTimeout(o),o=null),r=a,e.apply(l,c)):o||!1===n.trailing||(o=window.setTimeout(()=>{r=!1===n.leading?0:Date.now(),o=null,e.apply(l,c)},i))}}function P(e,t,n,o,r=window){const s=r.Object.getOwnPropertyDescriptor(e,t);return r.Object.defineProperty(e,t,o?n:{set(e){setTimeout(()=>{n.set.call(this,e)},0),s&&s.set&&s.set.call(this,e)}}),()=>P(e,t,s||{},!0)}function j(e,t,n){try{if(!(t in e))return()=>{};const o=e[t],r=n(o);return"function"==typeof r&&(r.prototype=r.prototype||{},Object.defineProperties(r,{__rrweb_original__:{enumerable:!1,value:o}})),e[t]=r,()=>{e[t]=o}}catch(e){return()=>{}}}function H(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function W(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function B(e,t){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){let n=!1;return"string"==typeof t?n=e.classList.contains(t):e.classList.forEach(e=>{t.test(e)&&(n=!0)}),n||B(e.parentNode,t)}return B(e.parentNode,t)}function q(e){return"__sn"in e&&-2===e.__sn.id}function V(e,t){if(h(e))return!1;const n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||V(e.parentNode,t))}function U(e){return Boolean(e.changedTouches)}function J(e){return"__sn"in e&&e.__sn.type===p.Element&&"iframe"===e.__sn.tagName}function X(e){return Boolean(null==e?void 0:e.shadowRoot)}function Y(e){return"__ln"in e}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(A=new Proxy(A,{get:(e,t,n)=>("map"===t&&console.error(z),Reflect.get(e,t,n))}));class G{constructor(){this.length=0,this.head=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let o=0;o<e;o++){var n;t=(null==(n=t)?void 0:n.next)||null}return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&Y(e.previousSibling)){const n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&Y(e.nextSibling)&&e.nextSibling.__ln.previous){const n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)}}const K=(e,t)=>`${e}@${t}`;function Z(e){return"__sn"in e}class Q{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new G,n=e=>{let t=e,n=-2;for(;-2===n;)t=t&&t.nextSibling,n=t&&this.mirror.getId(t);return-1===n&&B(e.nextSibling,this.blockClass)&&(n=null),n},o=o=>{var r;const s=o.getRootNode?null==(r=o.getRootNode())?void 0:r.host:null,a=!this.doc.contains(o)&&!this.doc.contains(s);if(!o.parentNode||a)return;const i=h(o.parentNode)?this.mirror.getId(s):this.mirror.getId(o.parentNode),l=n(o);if(-1===i||-1===l)return t.addNode(o);let c=M(o,{doc:this.doc,map:this.mirror.map,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,slimDOMOptions:this.slimDOMOptions,recordCanvas:this.recordCanvas,onSerialize:e=>{J(e)&&this.iframeManager.addIframe(e),X(o)&&this.shadowDomManager.addShadowRoot(o.shadowRoot,document)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t)}});c&&e.push({parentId:i,nextId:l,node:c})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of this.movedSet)te(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||o(e);for(const e of this.addedSet)ne(this.droppedSet,e)||te(this.removes,e,this.mirror)?ne(this.movedSet,e)?o(e):this.droppedSet.add(e):o(e);let r=null;for(;t.length;){let e=null;if(r){const t=this.mirror.getId(r.value.parentNode),o=n(r.value);-1!==t&&-1!==o&&(e=r)}if(!e)for(let o=t.length-1;o>=0;o--){const r=t.get(o),s=this.mirror.getId(r.value.parentNode),a=n(r.value);if(-1!==s&&-1!==a){e=r;break}}if(!e){for(;t.head;)t.removeNode(t.head.value);break}r=e.previous,t.removeNode(e.value),o(e.value)}const s={texts:this.texts.map(e=>({id:this.mirror.getId(e.node),value:e.value})).filter(e=>this.mirror.has(e.id)),attributes:this.attributes.map(e=>({id:this.mirror.getId(e.node),attributes:e.attributes})).filter(e=>this.mirror.has(e.id)),removes:this.removes,adds:e};(s.texts.length||s.attributes.length||s.removes.length||s.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.emissionCallback(s))},this.processMutation=e=>{if(!q(e.target))switch(e.type){case"characterData":{const t=e.target.textContent;B(e.target,this.blockClass)||t===e.oldValue||this.texts.push({value:N(e.target,this.maskTextClass,this.maskTextSelector)&&t?this.maskTextFn?this.maskTextFn(t):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target.getAttribute(e.attributeName);if(B(e.target,this.blockClass)||t===e.oldValue)return;let n=this.attributes.find(t=>t.node===e.target);n||(n={node:e.target,attributes:{}},this.attributes.push(n)),n.attributes[e.attributeName]=O(this.doc,e.target.tagName,e.attributeName,t);break}case"childList":e.addedNodes.forEach(t=>this.genAdds(t,e.target)),e.removedNodes.forEach(t=>{const n=this.mirror.getId(t),o=h(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);B(t,this.blockClass)||B(e.target,this.blockClass)||q(t)||(this.addedSet.has(t)?(ee(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===n||V(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[K(n,o)]?ee(this.movedSet,t):this.removes.push({parentId:o,id:n,isShadow:!!h(e.target)||void 0})),this.mapRemoves.push(t))})}},this.genAdds=(e,t)=>{if(!(B(e,this.blockClass)||t&&B(t,this.blockClass))){if(Z(e)){if(q(e))return;this.movedSet.add(e);let n=null;t&&Z(t)&&(n=t.__sn.id),n&&(this.movedMap[K(e.__sn.id,n)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);e.childNodes.forEach(e=>this.genAdds(e))}}}init(e,t,n,o,r,s,a,i,l,c,u,d,m,p){this.blockClass=t,this.blockSelector=n,this.maskTextClass=o,this.maskTextSelector=r,this.inlineStylesheet=s,this.maskInputOptions=a,this.maskTextFn=i,this.recordCanvas=l,this.slimDOMOptions=c,this.emissionCallback=e,this.doc=u,this.mirror=d,this.iframeManager=m,this.shadowDomManager=p}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1,this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0}unlock(){this.locked=!1,this.emit()}}function ee(e,t){e.delete(t),t.childNodes.forEach(t=>ee(e,t))}function te(e,t,n){const{parentNode:o}=t;if(!o)return!1;const r=n.getId(o);return!!e.some(e=>e.id===r)||te(e,o,n)}function ne(e,t){const{parentNode:n}=t;return!!n&&(!!e.has(n)||ne(e,n))}function oe(e){if(!e||!e.outerHTML)return"";let t="";for(;e.parentElement;){let n=e.localName;if(!n)break;n=n.toLowerCase();let o=e.parentElement,r=[];if(o.children&&o.children.length>0)for(let e=0;e<o.children.length;e++){let t=o.children[e];t.localName&&t.localName.toLowerCase&&t.localName.toLowerCase()===n&&r.push(t)}r.length>1&&(n+=":eq("+r.indexOf(e)+")"),t=n+(t?">"+t:""),e=o}return t}function re(e,t){const n={numOfKeysLimit:50};Object.assign(n,t);const o=[],r=[];return JSON.stringify(e,function(e,t){if(o.length>0){const n=o.indexOf(this);~n?o.splice(n+1):o.push(this),~n?r.splice(n,Infinity,e):r.push(e),~o.indexOf(t)&&(t=o[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,o.indexOf(t)).join(".")+"]")}else o.push(t);if(null==t)return t;if("object"==typeof(s=t)&&Object.keys(s).length>n.numOfKeysLimit||"function"==typeof s)return function(e){let t=e.toString();return n.stringLengthLimit&&t.length>n.stringLengthLimit&&(t=`${t.slice(0,n.stringLengthLimit)}...`),t}(t);var s;if(t instanceof Event){const e={};for(const n in t){const o=t[n];e[n]=Array.isArray(o)?oe(o.length?o[0]:null):o}return e}return t instanceof Node?t instanceof HTMLElement?t?t.outerHTML:"":t.nodeName:t})}class se{constructor(e){this.fileName=e.fileName||"",this.functionName=e.functionName||"",this.lineNumber=e.lineNumber,this.columnNumber=e.columnNumber}toString(){const e=this.lineNumber||"",t=this.columnNumber||"";return this.functionName?this.functionName+" ("+this.fileName+":"+e+":"+t+")":this.fileName+":"+e+":"+t}}const ae=/(^|@)\S+:\d+/,ie=/^\s*at .*(\S+:\d+|\(native\))/m,le=/^(eval@)?(\[native code])?$/,ce={parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(ie))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];const t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));if(!t)throw new Error(`Cannot parse given url: ${e}`);return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(ie)},this).map(function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(\),.*$)/g,""));let t=e.replace(/^\s+/,"").replace(/\(eval code/g,"(");const n=t.match(/ (\((.+):(\d+):(\d+)\)$)/);t=n?t.replace(n[0],""):t;const o=t.split(/\s+/).slice(1),r=this.extractLocation(n?n[1]:o.pop()),s=o.join(" ")||void 0,a=["eval","<anonymous>"].indexOf(r[0])>-1?void 0:r[0];return new se({functionName:s,fileName:a,lineNumber:r[1],columnNumber:r[2]})},this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter(function(e){return!e.match(le)},this).map(function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new se({functionName:e});{const t=/((.*".+"[^@]*)?[^@]*)(?:@)/,n=e.match(t),o=n&&n[1]?n[1]:void 0,r=this.extractLocation(e.replace(t,""));return new se({functionName:o,fileName:r[0],lineNumber:r[1],columnNumber:r[2]})}},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){const t=/Line (\d+).*script (?:in )?(\S+)/i,n=e.message.split("\n"),o=[];for(let e=2,r=n.length;e<r;e+=2){const r=t.exec(n[e]);r&&o.push(new se({fileName:r[2],lineNumber:parseFloat(r[1])}))}return o},parseOpera10:function(e){const t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=e.stacktrace.split("\n"),o=[];for(let e=0,r=n.length;e<r;e+=2){const r=t.exec(n[e]);r&&o.push(new se({functionName:r[3]||void 0,fileName:r[2],lineNumber:parseFloat(r[1])}))}return o},parseOpera11:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(ae)&&!e.match(/^Error created at/)},this).map(function(e){const t=e.split("@"),n=this.extractLocation(t.pop()),o=(t.shift()||"").replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;return new se({functionName:o,fileName:n[0],lineNumber:n[1],columnNumber:n[2]})},this)}},ue=[];function de(e,t,n,o,r,s,a,i,l,c,u,d,m,p,h){var f,g;const v=new Q;ue.push(v),v.init(e,n,o,r,s,a,i,l,c,u,t,d,m,p);let b=window.MutationObserver||window.__rrMutationObserver;const y=null==(f=window)||null==(g=f.Zone)||null==g.__symbol__?void 0:g.__symbol__("MutationObserver");y&&window[y]&&(b=window[y]);const k=new b(v.processMutations.bind(v));return k.observe(h,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),k}const me=["INPUT","TEXTAREA","SELECT"],pe=new WeakMap;class he{constructor(e){this.iframes=new WeakMap,this.mutationCb=e.mutationCb}addIframe(e){this.iframes.set(e,!0)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){var n;this.mutationCb({adds:[{parentId:e.__sn.id,nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null==(n=this.loadListener)||n.call(this,e)}}class fe{constructor(e){this.mutationCb=e.mutationCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror}addShadowRoot(e,t){de(this.mutationCb,t,this.bypassOptions.blockClass,this.bypassOptions.blockSelector,this.bypassOptions.maskTextClass,this.bypassOptions.maskTextSelector,this.bypassOptions.inlineStylesheet,this.bypassOptions.maskInputOptions,this.bypassOptions.maskTextFn,this.bypassOptions.recordCanvas,this.bypassOptions.slimDOMOptions,this.mirror,this.bypassOptions.iframeManager,this,e)}}function ge(e){return o({},e,{timestamp:Date.now()})}let ve,be;const ye={map:{},getId:e=>e.__sn?e.__sn.id:-1,getNode(e){return this.map[e]||null},removeNodeFromMap(e){delete this.map[e.__sn&&e.__sn.id],e.childNodes&&e.childNodes.forEach(e=>this.removeNodeFromMap(e))},has(e){return this.map.hasOwnProperty(e)},reset(){this.map={}}};function ke(e={}){const{emit:t,checkoutEveryNms:n,checkoutEveryNth:r,blockClass:s="rr-block",blockSelector:a=null,ignoreClass:i="rr-ignore",maskTextClass:l="rr-mask",maskTextSelector:c=null,inlineStylesheet:u=!0,maskAllInputs:d,maskInputOptions:m,slimDOMOptions:p,maskInputFn:h,maskTextFn:f,hooks:g,packFn:v,sampling:b={},mousemoveWait:y,recordCanvas:k=!1,collectFonts:S=!1,recordLog:C=!1}=e;if(!t)throw new Error("emit function is required");void 0!==y&&void 0===b.mousemove&&(b.mousemove=y);const w=!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:void 0!==m?m:{},T=!0===p||"all"===p?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===p,headMetaDescKeywords:"all"===p}:p||{},E={level:["assert","clear","count","countReset","debug","dir","dirxml","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","timeLog","trace","warn"],lengthThreshold:1e3,logger:console},x=C?!0===C?E:Object.assign({},E,C):{};let O;!function(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}();let N=0;ve=(e,o)=>{var s;if(null==(s=ue[0])||!s.isFrozen()||e.type===L.FullSnapshot||e.type===L.IncrementalSnapshot&&e.data.source===D.Mutation||ue.forEach(e=>e.unfreeze()),t(v?v(e):e,o),e.type===L.FullSnapshot)O=e,N=0;else if(e.type===L.IncrementalSnapshot){if(e.data.source===D.Mutation&&e.data.isAttachIframe)return;N++;const t=n&&e.timestamp-O.timestamp>n;(r&&N>=r||t)&&be(!0)}};const I=e=>{ve(ge({type:L.IncrementalSnapshot,data:o({source:D.Mutation},e)}))},R=new he({mutationCb:I}),z=new fe({mutationCb:I,bypassOptions:{blockClass:s,blockSelector:a,maskTextClass:l,maskTextSelector:c,inlineStylesheet:u,maskInputOptions:w,maskTextFn:f,recordCanvas:k,slimDOMOptions:T,iframeManager:R},mirror:ye});be=(e=!1)=>{var t,n,o,r,i,d,m,p,h,g;ve(ge({type:L.Meta,data:{href:window.location.href,width:W(),height:H()}}),e),ue.forEach(e=>e.lock());const[v,b]=function(e,t){const{blockClass:n="rr-block",blockSelector:o=null,maskTextClass:r="rr-mask",maskTextSelector:s=null,inlineStylesheet:a=!0,recordCanvas:i=!1,maskAllInputs:l=!1,maskTextFn:c,slimDOM:u=!1,preserveWhiteSpace:d,onSerialize:m,onIframeLoad:p,iframeLoadTimeout:h}=t||{},f={};return[M(e,{doc:e,map:f,blockClass:n,blockSelector:o,maskTextClass:r,maskTextSelector:s,skipChild:!1,inlineStylesheet:a,maskInputOptions:!0===l?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===l?{password:!0}:l,maskTextFn:c,slimDOMOptions:!0===u||"all"===u?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===u,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===u?{}:u,recordCanvas:i,preserveWhiteSpace:d,onSerialize:m,onIframeLoad:p,iframeLoadTimeout:h}),f]}(document,{blockClass:s,blockSelector:a,maskTextClass:l,maskTextSelector:c,inlineStylesheet:u,maskAllInputs:w,maskTextFn:f,slimDOM:T,recordCanvas:k,onSerialize:e=>{J(e)&&R.addIframe(e),X(e)&&z.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{R.attachIframe(e,t)}});if(!v)return console.warn("Failed to snapshot the document");ye.map=b,ve(ge({type:L.FullSnapshot,data:{node:v,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null==(t=document)?void 0:t.documentElement.scrollLeft)||(null==(n=document)||null==(o=n.body)||null==(r=o.parentElement)?void 0:r.scrollLeft)||(null==(i=document)?void 0:i.body.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null==(d=document)?void 0:d.documentElement.scrollTop)||(null==(m=document)||null==(p=m.body)||null==(h=p.parentElement)?void 0:h.scrollTop)||(null==(g=document)?void 0:g.body.scrollTop)||0}}})),ue.forEach(e=>e.unlock())};try{const e=[];e.push(F("DOMContentLoaded",()=>{ve(ge({type:L.DomContentLoaded,data:{}}))}));const t=e=>function(e,t={}){!function(e,t){const{mutationCb:n,mousemoveCb:o,mouseInteractionCb:r,scrollCb:s,viewportResizeCb:a,inputCb:i,mediaInteractionCb:l,styleSheetRuleCb:c,canvasMutationCb:u,fontCb:d,logCb:m}=e;e.mutationCb=(...e)=>{t.mutation&&t.mutation(...e),n(...e)},e.mousemoveCb=(...e)=>{t.mousemove&&t.mousemove(...e),o(...e)},e.mouseInteractionCb=(...e)=>{t.mouseInteraction&&t.mouseInteraction(...e),r(...e)},e.scrollCb=(...e)=>{t.scroll&&t.scroll(...e),s(...e)},e.viewportResizeCb=(...e)=>{t.viewportResize&&t.viewportResize(...e),a(...e)},e.inputCb=(...e)=>{t.input&&t.input(...e),i(...e)},e.mediaInteractionCb=(...e)=>{t.mediaInteaction&&t.mediaInteaction(...e),l(...e)},e.styleSheetRuleCb=(...e)=>{t.styleSheetRule&&t.styleSheetRule(...e),c(...e)},e.canvasMutationCb=(...e)=>{t.canvasMutation&&t.canvasMutation(...e),u(...e)},e.fontCb=(...e)=>{t.font&&t.font(...e),d(...e)},e.logCb=(...e)=>{t.log&&t.log(...e),m(...e)}}(e,t);const n=de(e.mutationCb,e.doc,e.blockClass,e.blockSelector,e.maskTextClass,e.maskTextSelector,e.inlineStylesheet,e.maskInputOptions,e.maskTextFn,e.recordCanvas,e.slimDOMOptions,e.mirror,e.iframeManager,e.shadowDomManager,e.doc),r=function(e,t,n,o){if(!1===t.mousemove)return()=>{};const r="number"==typeof t.mousemove?t.mousemove:50;let s,a=[];const i=$(t=>{const n=Date.now()-s;e(a.map(e=>(e.timeOffset-=n,e)),t),a=[],s=null},"number"==typeof t.mousemoveCallback?t.mousemoveCallback:500),l=$(e=>{const{target:t}=e,{clientX:n,clientY:r}=U(e)?e.changedTouches[0]:e;s||(s=Date.now()),a.push({x:n,y:r,id:o.getId(t),timeOffset:Date.now()-s}),i(e instanceof MouseEvent?D.MouseMove:e instanceof DragEvent?D.Drag:D.TouchMove)},r,{trailing:!1}),c=[F("mousemove",l,n),F("touchmove",l,n),F("drag",l,n)];return()=>{c.forEach(e=>e())}}(e.mousemoveCb,e.sampling,e.doc,e.mirror),s=function(e,t,n,o,r){if(!1===r.mouseInteraction)return()=>{};const s=!0===r.mouseInteraction||void 0===r.mouseInteraction?{}:r.mouseInteraction,a=[];return Object.keys(_).filter(e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==s[e]).forEach(r=>{const s=r.toLowerCase(),i=(t=>r=>{if(B(r.target,o))return;const s=U(r)?r.changedTouches[0]:r;if(!s)return;const a=n.getId(r.target),{clientX:i,clientY:l}=s;e({type:_[t],id:a,x:i,y:l})})(r);a.push(F(s,i,t))}),()=>{a.forEach(e=>e())}}(e.mouseInteractionCb,e.doc,e.mirror,e.blockClass,e.sampling),a=function(e,t,n,o,r){return F("scroll",$(r=>{if(!r.target||B(r.target,o))return;const s=n.getId(r.target);if(r.target===t){const n=t.scrollingElement||t.documentElement;e({id:s,x:n.scrollLeft,y:n.scrollTop})}else e({id:s,x:r.target.scrollLeft,y:r.target.scrollTop})},r.scroll||100))}(e.scrollCb,e.doc,e.mirror,e.blockClass,e.sampling),i=function(e){let t=-1,n=-1;return F("resize",$(()=>{const o=H(),r=W();t===o&&n===r||(e({width:Number(r),height:Number(o)}),t=o,n=r)},200),window)}(e.viewportResizeCb),l=function(e,t,n,r,s,a,i,l){function c(e){const{target:n}=e;if(!n||!n.tagName||me.indexOf(n.tagName)<0||B(n,r))return;const o=n.type;if("password"===o||n.classList.contains(s))return;let l=n.value,c=!1;"radio"===o||"checkbox"===o?c=n.checked:(a[n.tagName.toLowerCase()]||a[o])&&(l=i?i(l):"*".repeat(l.length)),u(n,{text:l,isChecked:c});const d=n.name;"radio"===o&&d&&c&&t.querySelectorAll(`input[type="radio"][name="${d}"]`).forEach(e=>{e!==n&&u(e,{text:e.value,isChecked:!c})})}function u(t,r){const s=pe.get(t);if(!s||s.text!==r.text||s.isChecked!==r.isChecked){pe.set(t,r);const s=n.getId(t);e(o({},r,{id:s}))}}const d=("last"===l.input?["change"]:["input","change"]).map(e=>F(e,c,t)),m=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),p=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"]];return m&&m.set&&d.push(...p.map(e=>P(e[0],e[1],{set(){c({target:this})}}))),()=>{d.forEach(e=>e())}}(e.inputCb,e.doc,e.mirror,e.blockClass,e.ignoreClass,e.maskInputOptions,e.maskInputFn,e.sampling),c=function(e,t,n){const o=o=>r=>{const{target:s}=r;s&&!B(s,t)&&e({type:"play"===o?0:1,id:n.getId(s)})},r=[F("play",o("play")),F("pause",o("pause"))];return()=>{r.forEach(e=>e())}}(e.mediaInteractionCb,e.blockClass,e.mirror),u=function(e,t){const n=CSSStyleSheet.prototype.insertRule;CSSStyleSheet.prototype.insertRule=function(o,r){const s=t.getId(this.ownerNode);return-1!==s&&e({id:s,adds:[{rule:o,index:r}]}),n.apply(this,arguments)};const o=CSSStyleSheet.prototype.deleteRule;return CSSStyleSheet.prototype.deleteRule=function(n){const r=t.getId(this.ownerNode);return-1!==r&&e({id:r,removes:[{index:n}]}),o.apply(this,arguments)},()=>{CSSStyleSheet.prototype.insertRule=n,CSSStyleSheet.prototype.deleteRule=o}}(e.styleSheetRuleCb,e.mirror),d=e.recordCanvas?function(e,t,n){const o=Object.getOwnPropertyNames(CanvasRenderingContext2D.prototype),r=[];for(const s of o)try{if("function"!=typeof CanvasRenderingContext2D.prototype[s])continue;const o=j(CanvasRenderingContext2D.prototype,s,function(o){return function(...r){return B(this.canvas,t)||setTimeout(()=>{const t=[...r];"drawImage"===s&&t[0]&&t[0]instanceof HTMLCanvasElement&&(t[0]=t[0].toDataURL()),e({id:n.getId(this.canvas),property:s,args:t})},0),o.apply(this,r)}});r.push(o)}catch(t){const o=P(CanvasRenderingContext2D.prototype,s,{set(t){e({id:n.getId(this.canvas),property:s,args:[t],setter:!0})}});r.push(o)}return()=>{r.forEach(e=>e())}}(e.canvasMutationCb,e.blockClass,e.mirror):()=>{},m=e.collectFonts?function(e){const t=[],n=new WeakMap,o=FontFace;window.FontFace=function(e,t,r){const s=new o(e,t,r);return n.set(s,{family:e,buffer:"string"!=typeof t,descriptors:r,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),s};const r=j(document.fonts,"add",function(t){return function(o){return setTimeout(()=>{const t=n.get(o);t&&(e(t),n.delete(o))},0),t.apply(this,[o])}});return t.push(()=>{window.FonFace=o}),t.push(r),()=>{t.forEach(e=>e())}}(e.fontCb):()=>{},p=e.logOptions?function(e,t){const n=t.logger;if(!n)return()=>{};let o=0;const r=[];if(t.level.includes("error")&&window){const n=window.onerror;window.onerror=(o,r,s,a,i)=>{n&&n.apply(this,[o,r,s,a,i]);const l=ce.parse(i).map(e=>e.toString()),c=[re(o,t.stringifyOptions)];e({level:"error",trace:l,payload:c})},r.push(()=>{window.onerror=n})}for(const e of t.level)r.push(s(n,e));return()=>{r.forEach(e=>e())};function s(n,r){return n[r]?j(n,r,n=>(...s)=>{n.apply(this,s);try{const n=ce.parse(new Error).map(e=>e.toString()).splice(1),a=s.map(e=>re(e,t.stringifyOptions));o++,o<t.lengthThreshold?e({level:r,trace:n,payload:a}):o===t.lengthThreshold&&e({level:"warn",trace:[],payload:[re("The number of log records reached the threshold.")]})}catch(e){n("rrweb logger error:",e,...s)}}):()=>{}}}(e.logCb,e.logOptions):()=>{};return()=>{n.disconnect(),r(),s(),a(),i(),l(),c(),u(),d(),m(),p()}}({mutationCb:I,mousemoveCb:(e,t)=>ve(ge({type:L.IncrementalSnapshot,data:{source:t,positions:e}})),mouseInteractionCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.MouseInteraction},e)})),scrollCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.Scroll},e)})),viewportResizeCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.ViewportResize},e)})),inputCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.Input},e)})),mediaInteractionCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.MediaInteraction},e)})),styleSheetRuleCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.StyleSheetRule},e)})),canvasMutationCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.CanvasMutation},e)})),fontCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.Font},e)})),logCb:e=>ve(ge({type:L.IncrementalSnapshot,data:o({source:D.Log},e)})),blockClass:s,ignoreClass:i,maskTextClass:l,maskTextSelector:c,maskInputOptions:w,inlineStylesheet:u,sampling:b,recordCanvas:k,collectFonts:S,doc:e,maskInputFn:h,maskTextFn:f,logOptions:x,blockSelector:a,slimDOMOptions:T,mirror:ye,iframeManager:R,shadowDomManager:z},g);R.addLoadListener(n=>{e.push(t(n.contentDocument))});const n=()=>{be(),e.push(t(document))};return"interactive"===document.readyState||"complete"===document.readyState?n():e.push(F("load",()=>{ve(ge({type:L.Load,data:{}})),n()},window)),()=>{e.forEach(e=>e())}}catch(e){console.warn(e)}}ke.addCustomEvent=(e,t)=>{if(!ve)throw new Error("please add custom event after start recording");ve(ge({type:L.Custom,data:{tag:e,payload:t}}))},ke.freezePage=()=>{ue.forEach(e=>e.freeze())},ke.takeFullSnapshot=e=>{if(!be)throw new Error("please take full snapshot after start recording");be(e)},ke.mirror=ye;const Se=r=>{const s=o({},r,{v:"v1"});return e(t(n(JSON.stringify(s))),!0)};class Ce{constructor(){this.eventsMatrix=[[]],this.globalErrorTrace(),this.networkErrorTrace(),this.promiseErrorTrace(),this.iframeErrorTrace(),ke(o({},m.recordOptions,{emit:(e,t)=>{t&&this.eventsMatrix.push([]),this.eventsMatrix[this.eventsMatrix.length-1].push(e)},recordLog:!1,checkoutEveryNth:10,packFn:Se}))}static getInstance(){return this.instance||(this.instance=new Ce),this.instance}globalErrorTrace(){s.onerror=(e,t,n,o,s)=>{d({source:t,lineno:n,colno:o,error:s});const a=this.eventsMatrix.length;if(m.errEventRoute&&a>=2){var i;const e=this.eventsMatrix[a-2].concat(this.eventsMatrix[a-1]);null==(i=m.reportData)||i.fetch(r.IDLE,JSON.stringify({events:e}),m.errEventRoute)}var l;return m.errLogRoute&&(null==(l=m.reportData)||l.fetch(r.IDLE,JSON.stringify({source:t,lineno:n,colno:o,error:JSON.stringify({message:null==s?void 0:s.message,stack:null==s?void 0:s.stack,name:null==s?void 0:s.name})}),m.errLogRoute)),!0}}networkErrorTrace(){s.addEventListener("error",e=>{e.target!==s&&d(e.target)},!0)}promiseErrorTrace(){window.addEventListener("unhandledrejection",e=>(e.preventDefault(),d(e.reason),!0))}iframeErrorTrace(){const e=s.frames;for(let t=0;t<e.length;t++)e[t].addEventListener("error",e=>{d(e)},!0),e[t].addEventListener("unhandledrejection",e=>{d(e)},!0)}}Ce.instance=null;class we{fetch(e,t,n){switch(n=m.fetchDomain+n,e){case r.URGENT:if(s.fetch)fetch(n,{body:t,method:"POST",keepalive:!0});else{let e=new XMLHttpRequest;e.open("post",n,!0),e.setRequestHeader("Content-Type","application/json"),e.send(t),e.onload=()=>e=null}return;default:if(i.sendBeacon)navigator.sendBeacon(n,t);else{let e=new Image;e.src=`${n}?body=${t}`,e.onload=()=>e=null}}}}const Te=()=>a&&!!a.getEntriesByType&&!!a.now&&!!a.mark,Ee=e=>parseFloat((e/Math.pow(1024,2)).toFixed(2)),xe=e=>parseFloat(e.toFixed(2)),Oe=e=>{"requestIdleCallback"in s?s.requestIdleCallback(e,{timeout:3e3}):e()},Ne=async()=>{if(!i.storage)return{usageDetails:{}};const{quota:e,usage:t,usageDetails:n}=await i.storage.estimate();let o={quota:Ee(e||0),usage:Ee(t||0),usageDetails:n};return o.usageDetails&&Object.keys(o.usageDetails||{}).forEach(e=>o.usageDetails[e]=Ee(o.usageDetails[e])),o};let Ie="4g",Me=!1;const Le=async()=>new Promise(e=>{let t={};"connection"in i&&(t.connection={downlink:i.connection.downlink,effectiveType:i.connection.effectiveType,rtt:i.connection.rtt,saveData:i.connection.saveData},Me=t.connection.saveData||Me,Ie=t.connection.effectiveType||Ie),"fetch"in window&&Oe(async()=>{let n=[];const o=[0,0,0,50,100];n.push(+new Date);for(let e of o)await fetch(`http://performance-monitoring.zhourengui.top/performance-monitoring/doppler-velocity?size=${e}`),n.push(+new Date);t.connection.bandwidth=`${((o[4]-o[3])/((n[5]-n[4])/1e3)).toFixed(2)} k/s`,e(t)}),t.userAgent=i.userAgent}),De=async()=>{let e={};if(Te()){const t=a.getEntriesByType("navigation")[0];if(t){const n=t.responseEnd,o=t.responseStart,r=t.requestStart;e={fetchTime:n-t.fetchStart,workerTime:n-t.workerStart,networkTime:n-r,downloadTime:n-o,timeToFirstByte:o-r,headerSize:t.decodedBodySize-t.transferSize||0,dnsLookupTime:t.domainLookupStart-t.domainLookupEnd,tcpTime:t.connectStart-t.connectEnd||0,firstPaintTime:n-o||0,domParseTime:t.domComplete-t.domInteractive,domRenderTime:t.domContentLoadedEventEnd-t.domContentLoadedEventStart||0,onloadTime:t.loadEventEnd-t.loadEventStart}}}return e},_e=()=>i.deviceMemory<=4||i.hardwareConcurrency<=4,Re=(e,t)=>!!["slow-2g","2g","3g"].includes(e)||_e()||t,Fe=()=>{var e;if(i)return{deviceMemory:i.deviceMemory||0,hardwareConcurrency:i.hardwareConcurrency||0,serviceWorkerStatus:"serviceWorker"in i?null!=(e=i.serviceWorker)&&e.controller?"controlled":"supported":"unsupported",isLowEndDevice:_e(),isLowEndExperience:Re(Ie,Me)}},ze=[1e3,2500],Ae=[2500,4e3],$e=[100,300],Pe=[.1,.25],je=[300,600],He={fp:ze,fcp:ze,lcp:Ae,lcpFinal:Ae,fid:$e,fidVitals:$e,cls:Pe,clsFinal:Pe,tbt:je,tbt5S:je,tbt10S:je,tbtFinal:je},We=(e,t)=>He[e]?t<=He[e][0]?"good":t<=He[e][1]?"needsImprovement":"poor":null,Be=(e,t,n)=>{Oe(()=>{("hidden"!==c.visibilityState||t.includes("Final"))&&m.analyticsTracker&&m.analyticsTracker({metricName:t,data:e,eventProperties:n,navigatorInformation:Fe(),vitalsScore:We(t,e)})})},qe=(e,t,n)=>{Object.keys(t).forEach(e=>{"number"==typeof t[e]&&(t[e]=xe(t[e]))}),Be(t,e,n)},Ve=(e,t,n)=>{xe(t)<=m.maxTime&&Be(t,e,n)},Ue={value:0},Je={value:0},Xe={value:0},Ye={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},Ge={value:0},Ke=e=>{const t=e.pop();t&&(Xe.value=t.renderTime||t.startTime)},Ze=e=>{for(let t=0;t<e.length;t++){const n=e[t];n.identifier&&Ve(n.identifier,n.startTime,{performanceEntry:n})}},Qe=e=>{for(let t=0;t<e.length;t++){const n=e[t];if("self"!==n.name&&n.startTime<Ue.value)return;n.startTime-50>0&&(Je.value+=n.startTime,Ve("longtask",n.startTime))}},et=e=>{const t=e.pop();t&&(Ve("fidVitals",t.processingStart-t.startTime,{performanceEntry:t}),Ve("fid",t.duration,{performanceEntry:t})),st("first-input"),Ve("lcp",Xe.value),ot["layout-shift"]&&"function"==typeof ot["layout-shift"].takeRecords&&ot["layout-shift"].takeRecords(),Ve("cls",Ge.value),Ve("bt",Je.value),setTimeout(()=>{Ve("bt5S",Je.value)},5e3),setTimeout(()=>{Ve("bt10S",Je.value),qe("dataConsumption",Ye.value)},1e4)},tt=e=>{for(let t=0;t<e.length;t++){const n=e[t];if(qe("resourceTiming",n),n.decodedBodySize&&n.initiatorType){const e=n.decodedBodySize/1e3;Ye.value[n.initiatorType]+=e,Ye.value.total+=e}}},nt=e=>{const t=e.pop();t&&!t.hadRecentInput&&t.value&&(Ge.value+=t.value)},ot={},rt=(e,t)=>{try{const n=new PerformanceObserver(e=>t(e.getEntries()));return n.observe({type:e,buffered:!0}),n}catch(e){l.warn("PerformanceMonitoring obseverðŸŒ²:",`mini-pm: ${e}`)}return null},st=e=>{var t;ot[e]&&(null==(t=ot[e])||t.disconnect()),delete ot[e]},at=()=>{ot["largest-contentful-paint"]&&(Ve("lcpFinal",Xe.value),st("largest-contentful-paint")),ot["layout-shift"]&&("function"==typeof ot["layout-shift"].takeRecords&&ot["layout-shift"].takeRecords(),Ve("clsFinal",Ge.value),st("layout-shift")),ot.longtask&&(Ve("btFinal",Je.value),st("longtask"))};export default class{constructor(e){const{isObserverElementTiming:t,isObserverResourceTiming:n,maxTime:o,captureError:s,fetchDomain:a,errLogRoute:i,errEventRoute:l,logRoute:d,analyticsTracker:p,recordOptions:h}=e||{};var f;m.isObserverElementTiming=!!t,m.isObserverResourceTiming=!!n,m.maxTime=o||m.maxTime,m.captureError=s||m.captureError,m.fetchDomain=a,m.errLogRoute=i,m.errEventRoute=l,m.logRoute=d,m.reportData=new we,m.analyticsTracker=p||m.analyticsTracker,m.recordOptions=h||m.recordOptions,u("1.1.3"),s&&a&&Ce.getInstance(),Te()&&("hidden"===c.visibilityState&&c.addEventListener("visibilitychange",at),a&&d&&Promise.all([De(),Le(),Ne()]).then(e=>{var t;null==(t=m.reportData)||t.fetch(r.IDLE,JSON.stringify(e),d)}),ot.paint=rt("paint",(f=()=>ot.longtask=rt("longtask",Qe),e=>{for(let t=0;t<e.length;t++){const n=e[t];"first-paint"===n.name?Ve("fp",n.startTime):"first-contentful-paint"===n.name&&(Ue.value=n.startTime,Ve("fcp",n.startTime),f(),st("paint"))}})),ot["first-input"]=rt("first-input",et),ot["largest-contentful-paint"]=rt("largest-contentful-paint",Ke),m.isObserverResourceTiming&&rt("resource",tt),ot["layout-shift"]=rt("layout-shift",nt),m.isObserverElementTiming&&rt("element",Ze))}}
//# sourceMappingURL=mini-pm.modern.js.map
