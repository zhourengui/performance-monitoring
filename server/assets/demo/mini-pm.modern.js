function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var t;!function(e){e[e.URGENT=1]="URGENT",e[e.IDLE=2]="IDLE"}(t||(t={}));const n=window,o=n.performance,r=n.navigator,s=n.console,a=document,i=(e,...t)=>s.log("mini-pmðŸ¢ï¼š",e,...t),l=(e,...t)=>s.warn("mini-pmðŸ¢ï¼š",e,...t),c={isObserverResourceTiming:!1,isObserverElementTiming:!1,maxTime:15e3,captureError:!0,reportData:null,analyticsTracker:e=>{i(e)},recordOptions:{}};var u;function d(e){const t=null==e?void 0:e.host;return Boolean(t&&t.shadowRoot&&t.shadowRoot===e)}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(u||(u={}));let m=1;const h=RegExp("[^a-z0-9-_]");function p(e){try{const t=e.rules||e.cssRules;return t?Array.from(t).map(f).join(""):null}catch(e){return null}}function f(e){return function(e){return"styleSheet"in e}(e)?p(e.styleSheet)||"":e.cssText}const g=/url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm,v=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,y=/^(data:)([^,]*),(.*)/i;function b(e,t){return(e||"").replace(g,(e,n,o,r,s,a)=>{const i=o||s||a,l=n||r||"";if(!i)return e;if(!v.test(i))return`url(${l}${i}${l})`;if(y.test(i))return`url(${l}${i}${l})`;if("/"===i[0])return`url(${l}${function(e){let t;return t=e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0],t=t.split("?")[0],t}(t)+i}${l})`;const c=t.split("/"),u=i.split("/");c.pop();for(const e of u)"."!==e&&(".."===e?c.pop():c.push(e));return`url(${l}${c.join("/")}${l})`})}const k=/^[^ \t\n\r\u000c]+/,S=/^[, \t\n\r\u000c]+/;function w(e,t){if(!t||""===t.trim())return t;const n=e.createElement("a");return n.href=t,n.href}function C(){const e=document.createElement("a");return e.href="",e.href}function T(e,t,n,o){return"src"===n||("href"===n||"xlink:href"===n)&&o?w(e,o):"background"!==n||!o||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n&&o?function(e,t){if(""===t.trim())return t;let n=0;function o(e){var o,r=e.exec(t.substring(n));return r?(n+=(o=r[0]).length,o):""}let r=[];for(;o(S),!(n>=t.length);){let s=o(k);if(","===s.slice(-1))s=w(e,s.substring(0,s.length-1)),r.push(s);else{let o="";s=w(e,s);let a=!1;for(;;){let e=t.charAt(n);if(""===e){r.push((s+o).trim());break}if(a)")"===e&&(a=!1);else{if(","===e){n+=1,r.push((s+o).trim());break}"("===e&&(a=!0)}o+=e,n+=1}}}return r.join(", ")}(e,o):"style"===n&&o?b(o,C()):o:w(e,o)}function E(e,t,n){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){if("string"==typeof t){if(e.classList.contains(t))return!0}else e.classList.forEach(e=>{if(t.test(e))return!0});return!(!n||!e.matches(n))||E(e.parentNode,t,n)}return E(e.parentNode,t,n)}function x(e){return void 0===e?"":e.toLowerCase()}function O(e,t){const{doc:n,map:o,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:l=!1,inlineStylesheet:c=!0,maskInputOptions:f={},maskTextFn:g,slimDOMOptions:v,recordCanvas:y=!1,onSerialize:k,onIframeLoad:S,iframeLoadTimeout:w=5e3}=t;let{preserveWhiteSpace:M=!0}=t;const N=function(e,t){const{doc:n,blockClass:o,blockSelector:r,maskTextClass:s,maskTextSelector:a,inlineStylesheet:i,maskInputOptions:l={},maskTextFn:c,recordCanvas:d}=t;let m;if(n.__sn){const e=n.__sn.id;m=1===e?void 0:e}switch(e.nodeType){case e.DOCUMENT_NODE:return{type:u.Document,childNodes:[],rootId:m};case e.DOCUMENT_TYPE_NODE:return{type:u.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:m};case e.ELEMENT_NODE:const t=function(e,t,n){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(let n=0;n<e.classList.length;n++)if(t.test(e.classList[n]))return!0;return!!n&&e.matches(n)}(e,o,r),g=function(e){if(e instanceof HTMLFormElement)return"form";const t=e.tagName.toLowerCase().trim();return h.test(t)?"div":t}(e);let v={};for(const{name:t,value:o}of Array.from(e.attributes))v[t]=T(n,g,t,o);if("link"===g&&i){const t=Array.from(n.styleSheets).find(t=>t.href===e.href),o=p(t);o&&(delete v.rel,delete v.href,v._cssText=b(o,t.href))}if("style"===g&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const t=p(e.sheet);t&&(v._cssText=b(t,C()))}if("input"===g||"textarea"===g||"select"===g){const t=e.value;"radio"!==v.type&&"checkbox"!==v.type&&"submit"!==v.type&&"button"!==v.type&&t?v.value=l[v.type]||l[g]?"*".repeat(t.length):t:e.checked&&(v.checked=e.checked)}if("option"===g&&v.value===e.parentElement.value&&(v.selected=e.selected),"canvas"===g&&d&&(v.rr_dataURL=e.toDataURL()),"audio"!==g&&"video"!==g||(v.rr_mediaState=e.paused?"paused":"played"),e.scrollLeft&&(v.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(v.rr_scrollTop=e.scrollTop),t){const{width:t,height:n}=e.getBoundingClientRect();v={class:v.class,rr_width:`${t}px`,rr_height:`${n}px`}}return"iframe"===g&&delete v.src,{type:u.Element,tagName:g,attributes:v,childNodes:[],isSVG:(f=e,"svg"===f.tagName||f instanceof SVGElement||void 0),needBlock:t,rootId:m};case e.TEXT_NODE:const y=e.parentNode&&e.parentNode.tagName;let k=e.textContent;const S="STYLE"===y||void 0,w="SCRIPT"===y||void 0;return S&&k&&(k=b(k,C())),w&&(k="SCRIPT_PLACEHOLDER"),!S&&!w&&E(e,s,a)&&k&&(k=c?c(k):k.replace(/[\S]/g,"*")),{type:u.Text,textContent:k||"",isStyle:S,rootId:m};case e.CDATA_SECTION_NODE:return{type:u.CDATA,textContent:"",rootId:m};case e.COMMENT_NODE:return{type:u.Comment,textContent:e.textContent||"",rootId:m};default:return!1}var f}(e,{doc:n,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,inlineStylesheet:c,maskInputOptions:f,maskTextFn:g,recordCanvas:y});if(!N)return console.warn(e,"not serialized"),null;let I;I="__sn"in e?e.__sn.id:!function(e,t){if(t.comment&&e.type===u.Comment)return!0;if(e.type===u.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(x(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===x(e.attributes.name)||"icon"===x(e.attributes.rel)||"apple-touch-icon"===x(e.attributes.rel)||"shortcut icon"===x(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&x(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(x(e.attributes.property).match(/^(og|twitter|fb):/)||x(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===x(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===x(e.attributes.name)||"googlebot"===x(e.attributes.name)||"bingbot"===x(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===x(e.attributes.name)||"generator"===x(e.attributes.name)||"framework"===x(e.attributes.name)||"publisher"===x(e.attributes.name)||"progid"===x(e.attributes.name)||x(e.attributes.property).match(/^article:/)||x(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===x(e.attributes.name)||"yandex-verification"===x(e.attributes.name)||"csrf-token"===x(e.attributes.name)||"p:domain_verify"===x(e.attributes.name)||"verify-v1"===x(e.attributes.name)||"verification"===x(e.attributes.name)||"shopify-checkout-api-token"===x(e.attributes.name)))return!0}}return!1}(N,v)&&(M||N.type!==u.Text||N.isStyle||N.textContent.replace(/^\s+|\s+$/gm,"").length)?m++:-2;const L=Object.assign(N,{id:I});if(e.__sn=L,-2===I)return null;o[I]=e,k&&k(e);let D=!l;if(L.type===u.Element&&(D=D&&!L.needBlock,delete L.needBlock),(L.type===u.Document||L.type===u.Element)&&D){v.headWhitespace&&N.type===u.Element&&"head"===N.tagName&&(M=!1);const t={doc:n,map:o,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:l,inlineStylesheet:c,maskInputOptions:f,maskTextFn:g,slimDOMOptions:v,recordCanvas:y,preserveWhiteSpace:M,onSerialize:k,onIframeLoad:S,iframeLoadTimeout:w};for(const n of Array.from(e.childNodes)){const e=O(n,t);e&&L.childNodes.push(e)}if(function(e){return e.nodeType===e.ELEMENT_NODE}(e)&&e.shadowRoot){L.isShadowHost=!0;for(const n of Array.from(e.shadowRoot.childNodes)){const e=O(n,t);e&&(e.isShadow=!0,L.childNodes.push(e))}}}return e.parentNode&&d(e.parentNode)&&(L.isShadow=!0),L.type===u.Element&&"iframe"===L.tagName&&function(e,t,n){const o=e.contentWindow;if(!o)return;let r,s=!1;try{r=o.document.readyState}catch(e){return}if("complete"!==r){const o=setTimeout(()=>{s||(t(),s=!0)},n);return void e.addEventListener("load",()=>{clearTimeout(o),s=!0,t()})}const a="about:blank";o.location.href===a&&e.src!==a&&""!==e.src?e.addEventListener("load",t):t()}(e,()=>{const t=e.contentDocument;if(t&&S){const n=O(t,{doc:t,map:o,blockClass:r,blockSelector:s,maskTextClass:a,maskTextSelector:i,skipChild:!1,inlineStylesheet:c,maskInputOptions:f,maskTextFn:g,slimDOMOptions:v,recordCanvas:y,preserveWhiteSpace:M,onSerialize:k,onIframeLoad:S,iframeLoadTimeout:w});n&&S(e,n)}},w),L}var M,N,I,L;function D(e,t,n=document){const o={capture:!0,passive:!0};return n.addEventListener(e,t,o),()=>n.removeEventListener(e,t,o)}!function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom"}(M||(M={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag"}(N||(N={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd"}(I||(I={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"}(L||(L={}));const _="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let R={map:{},getId:()=>(console.error(_),-1),getNode:()=>(console.error(_),null),removeNodeFromMap(){console.error(_)},has:()=>(console.error(_),!1),reset(){console.error(_)}};function F(e,t,n={}){let o=null,r=0;return function(s){let a=Date.now();r||!1!==n.leading||(r=a);let i=t-(a-r),l=this,c=arguments;i<=0||i>t?(o&&(window.clearTimeout(o),o=null),r=a,e.apply(l,c)):o||!1===n.trailing||(o=window.setTimeout(()=>{r=!1===n.leading?0:Date.now(),o=null,e.apply(l,c)},i))}}function A(e,t,n,o,r=window){const s=r.Object.getOwnPropertyDescriptor(e,t);return r.Object.defineProperty(e,t,o?n:{set(e){setTimeout(()=>{n.set.call(this,e)},0),s&&s.set&&s.set.call(this,e)}}),()=>A(e,t,s||{},!0)}function z(e,t,n){try{if(!(t in e))return()=>{};const o=e[t],r=n(o);return"function"==typeof r&&(r.prototype=r.prototype||{},Object.defineProperties(r,{__rrweb_original__:{enumerable:!1,value:o}})),e[t]=r,()=>{e[t]=o}}catch(e){return()=>{}}}function $(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function P(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function j(e,t){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){let n=!1;return"string"==typeof t?n=e.classList.contains(t):e.classList.forEach(e=>{t.test(e)&&(n=!0)}),n||j(e.parentNode,t)}return j(e.parentNode,t)}function H(e){return"__sn"in e&&-2===e.__sn.id}function W(e,t){if(d(e))return!1;const n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||W(e.parentNode,t))}function B(e){return Boolean(e.changedTouches)}function q(e){return"__sn"in e&&e.__sn.type===u.Element&&"iframe"===e.__sn.tagName}function U(e){return Boolean(null==e?void 0:e.shadowRoot)}function V(e){return"__ln"in e}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(R=new Proxy(R,{get:(e,t,n)=>("map"===t&&console.error(_),Reflect.get(e,t,n))}));class J{constructor(){this.length=0,this.head=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let o=0;o<e;o++){var n;t=(null==(n=t)?void 0:n.next)||null}return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&V(e.previousSibling)){const n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&V(e.nextSibling)&&e.nextSibling.__ln.previous){const n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)}}const X=(e,t)=>`${e}@${t}`;function Y(e){return"__sn"in e}class G{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new J,n=e=>{let t=e,n=-2;for(;-2===n;)t=t&&t.nextSibling,n=t&&this.mirror.getId(t);return-1===n&&j(e.nextSibling,this.blockClass)&&(n=null),n},o=o=>{var r;const s=o.getRootNode?null==(r=o.getRootNode())?void 0:r.host:null,a=!this.doc.contains(o)&&!this.doc.contains(s);if(!o.parentNode||a)return;const i=d(o.parentNode)?this.mirror.getId(s):this.mirror.getId(o.parentNode),l=n(o);if(-1===i||-1===l)return t.addNode(o);let c=O(o,{doc:this.doc,map:this.mirror.map,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,slimDOMOptions:this.slimDOMOptions,recordCanvas:this.recordCanvas,onSerialize:e=>{q(e)&&this.iframeManager.addIframe(e),U(o)&&this.shadowDomManager.addShadowRoot(o.shadowRoot,document)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t)}});c&&e.push({parentId:i,nextId:l,node:c})};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of this.movedSet)Z(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||o(e);for(const e of this.addedSet)Q(this.droppedSet,e)||Z(this.removes,e,this.mirror)?Q(this.movedSet,e)?o(e):this.droppedSet.add(e):o(e);let r=null;for(;t.length;){let e=null;if(r){const t=this.mirror.getId(r.value.parentNode),o=n(r.value);-1!==t&&-1!==o&&(e=r)}if(!e)for(let o=t.length-1;o>=0;o--){const r=t.get(o),s=this.mirror.getId(r.value.parentNode),a=n(r.value);if(-1!==s&&-1!==a){e=r;break}}if(!e){for(;t.head;)t.removeNode(t.head.value);break}r=e.previous,t.removeNode(e.value),o(e.value)}const s={texts:this.texts.map(e=>({id:this.mirror.getId(e.node),value:e.value})).filter(e=>this.mirror.has(e.id)),attributes:this.attributes.map(e=>({id:this.mirror.getId(e.node),attributes:e.attributes})).filter(e=>this.mirror.has(e.id)),removes:this.removes,adds:e};(s.texts.length||s.attributes.length||s.removes.length||s.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.emissionCallback(s))},this.processMutation=e=>{if(!H(e.target))switch(e.type){case"characterData":{const t=e.target.textContent;j(e.target,this.blockClass)||t===e.oldValue||this.texts.push({value:E(e.target,this.maskTextClass,this.maskTextSelector)&&t?this.maskTextFn?this.maskTextFn(t):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target.getAttribute(e.attributeName);if(j(e.target,this.blockClass)||t===e.oldValue)return;let n=this.attributes.find(t=>t.node===e.target);n||(n={node:e.target,attributes:{}},this.attributes.push(n)),n.attributes[e.attributeName]=T(this.doc,e.target.tagName,e.attributeName,t);break}case"childList":e.addedNodes.forEach(t=>this.genAdds(t,e.target)),e.removedNodes.forEach(t=>{const n=this.mirror.getId(t),o=d(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);j(t,this.blockClass)||j(e.target,this.blockClass)||H(t)||(this.addedSet.has(t)?(K(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===n||W(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[X(n,o)]?K(this.movedSet,t):this.removes.push({parentId:o,id:n,isShadow:!!d(e.target)||void 0})),this.mapRemoves.push(t))})}},this.genAdds=(e,t)=>{if(!(j(e,this.blockClass)||t&&j(t,this.blockClass))){if(Y(e)){if(H(e))return;this.movedSet.add(e);let n=null;t&&Y(t)&&(n=t.__sn.id),n&&(this.movedMap[X(e.__sn.id,n)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);e.childNodes.forEach(e=>this.genAdds(e))}}}init(e,t,n,o,r,s,a,i,l,c,u,d,m,h){this.blockClass=t,this.blockSelector=n,this.maskTextClass=o,this.maskTextSelector=r,this.inlineStylesheet=s,this.maskInputOptions=a,this.maskTextFn=i,this.recordCanvas=l,this.slimDOMOptions=c,this.emissionCallback=e,this.doc=u,this.mirror=d,this.iframeManager=m,this.shadowDomManager=h}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1,this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0}unlock(){this.locked=!1,this.emit()}}function K(e,t){e.delete(t),t.childNodes.forEach(t=>K(e,t))}function Z(e,t,n){const{parentNode:o}=t;if(!o)return!1;const r=n.getId(o);return!!e.some(e=>e.id===r)||Z(e,o,n)}function Q(e,t){const{parentNode:n}=t;return!!n&&(!!e.has(n)||Q(e,n))}function ee(e){if(!e||!e.outerHTML)return"";let t="";for(;e.parentElement;){let n=e.localName;if(!n)break;n=n.toLowerCase();let o=e.parentElement,r=[];if(o.children&&o.children.length>0)for(let e=0;e<o.children.length;e++){let t=o.children[e];t.localName&&t.localName.toLowerCase&&t.localName.toLowerCase()===n&&r.push(t)}r.length>1&&(n+=":eq("+r.indexOf(e)+")"),t=n+(t?">"+t:""),e=o}return t}function te(e,t){const n={numOfKeysLimit:50};Object.assign(n,t);const o=[],r=[];return JSON.stringify(e,function(e,t){if(o.length>0){const n=o.indexOf(this);~n?o.splice(n+1):o.push(this),~n?r.splice(n,Infinity,e):r.push(e),~o.indexOf(t)&&(t=o[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,o.indexOf(t)).join(".")+"]")}else o.push(t);if(null==t)return t;if("object"==typeof(s=t)&&Object.keys(s).length>n.numOfKeysLimit||"function"==typeof s)return function(e){let t=e.toString();return n.stringLengthLimit&&t.length>n.stringLengthLimit&&(t=`${t.slice(0,n.stringLengthLimit)}...`),t}(t);var s;if(t instanceof Event){const e={};for(const n in t){const o=t[n];e[n]=Array.isArray(o)?ee(o.length?o[0]:null):o}return e}return t instanceof Node?t instanceof HTMLElement?t?t.outerHTML:"":t.nodeName:t})}class ne{constructor(e){this.fileName=e.fileName||"",this.functionName=e.functionName||"",this.lineNumber=e.lineNumber,this.columnNumber=e.columnNumber}toString(){const e=this.lineNumber||"",t=this.columnNumber||"";return this.functionName?this.functionName+" ("+this.fileName+":"+e+":"+t+")":this.fileName+":"+e+":"+t}}const oe=/(^|@)\S+:\d+/,re=/^\s*at .*(\S+:\d+|\(native\))/m,se=/^(eval@)?(\[native code])?$/,ae={parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(re))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];const t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));if(!t)throw new Error(`Cannot parse given url: ${e}`);return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(re)},this).map(function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(\),.*$)/g,""));let t=e.replace(/^\s+/,"").replace(/\(eval code/g,"(");const n=t.match(/ (\((.+):(\d+):(\d+)\)$)/);t=n?t.replace(n[0],""):t;const o=t.split(/\s+/).slice(1),r=this.extractLocation(n?n[1]:o.pop()),s=o.join(" ")||void 0,a=["eval","<anonymous>"].indexOf(r[0])>-1?void 0:r[0];return new ne({functionName:s,fileName:a,lineNumber:r[1],columnNumber:r[2]})},this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter(function(e){return!e.match(se)},this).map(function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new ne({functionName:e});{const t=/((.*".+"[^@]*)?[^@]*)(?:@)/,n=e.match(t),o=n&&n[1]?n[1]:void 0,r=this.extractLocation(e.replace(t,""));return new ne({functionName:o,fileName:r[0],lineNumber:r[1],columnNumber:r[2]})}},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){const t=/Line (\d+).*script (?:in )?(\S+)/i,n=e.message.split("\n"),o=[];for(let e=2,r=n.length;e<r;e+=2){const r=t.exec(n[e]);r&&o.push(new ne({fileName:r[2],lineNumber:parseFloat(r[1])}))}return o},parseOpera10:function(e){const t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=e.stacktrace.split("\n"),o=[];for(let e=0,r=n.length;e<r;e+=2){const r=t.exec(n[e]);r&&o.push(new ne({functionName:r[3]||void 0,fileName:r[2],lineNumber:parseFloat(r[1])}))}return o},parseOpera11:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(oe)&&!e.match(/^Error created at/)},this).map(function(e){const t=e.split("@"),n=this.extractLocation(t.pop()),o=(t.shift()||"").replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;return new ne({functionName:o,fileName:n[0],lineNumber:n[1],columnNumber:n[2]})},this)}},ie=[];function le(e,t,n,o,r,s,a,i,l,c,u,d,m,h,p){var f,g;const v=new G;ie.push(v),v.init(e,n,o,r,s,a,i,l,c,u,t,d,m,h);let y=window.MutationObserver||window.__rrMutationObserver;const b=null==(f=window)||null==(g=f.Zone)||null==g.__symbol__?void 0:g.__symbol__("MutationObserver");b&&window[b]&&(y=window[b]);const k=new y(v.processMutations.bind(v));return k.observe(p,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),k}const ce=["INPUT","TEXTAREA","SELECT"],ue=new WeakMap;class de{constructor(e){this.iframes=new WeakMap,this.mutationCb=e.mutationCb}addIframe(e){this.iframes.set(e,!0)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){var n;this.mutationCb({adds:[{parentId:e.__sn.id,nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null==(n=this.loadListener)||n.call(this,e)}}class me{constructor(e){this.mutationCb=e.mutationCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror}addShadowRoot(e,t){le(this.mutationCb,t,this.bypassOptions.blockClass,this.bypassOptions.blockSelector,this.bypassOptions.maskTextClass,this.bypassOptions.maskTextSelector,this.bypassOptions.inlineStylesheet,this.bypassOptions.maskInputOptions,this.bypassOptions.maskTextFn,this.bypassOptions.recordCanvas,this.bypassOptions.slimDOMOptions,this.mirror,this.bypassOptions.iframeManager,this,e)}}function he(t){return e({},t,{timestamp:Date.now()})}let pe,fe;const ge={map:{},getId:e=>e.__sn?e.__sn.id:-1,getNode(e){return this.map[e]||null},removeNodeFromMap(e){delete this.map[e.__sn&&e.__sn.id],e.childNodes&&e.childNodes.forEach(e=>this.removeNodeFromMap(e))},has(e){return this.map.hasOwnProperty(e)},reset(){this.map={}}};function ve(t={}){const{emit:n,checkoutEveryNms:o,checkoutEveryNth:r,blockClass:s="rr-block",blockSelector:a=null,ignoreClass:i="rr-ignore",maskTextClass:l="rr-mask",maskTextSelector:c=null,inlineStylesheet:u=!0,maskAllInputs:d,maskInputOptions:m,slimDOMOptions:h,maskInputFn:p,maskTextFn:f,hooks:g,packFn:v,sampling:y={},mousemoveWait:b,recordCanvas:k=!1,collectFonts:S=!1,recordLog:w=!1}=t;if(!n)throw new Error("emit function is required");void 0!==b&&void 0===y.mousemove&&(y.mousemove=b);const C=!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:void 0!==m?m:{},T=!0===h||"all"===h?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===h,headMetaDescKeywords:"all"===h}:h||{},E={level:["assert","clear","count","countReset","debug","dir","dirxml","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","timeLog","trace","warn"],lengthThreshold:1e3,logger:console},x=w?!0===w?E:Object.assign({},E,w):{};let L;!function(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}();let _=0;pe=(e,t)=>{var s;if(null==(s=ie[0])||!s.isFrozen()||e.type===M.FullSnapshot||e.type===M.IncrementalSnapshot&&e.data.source===N.Mutation||ie.forEach(e=>e.unfreeze()),n(v?v(e):e,t),e.type===M.FullSnapshot)L=e,_=0;else if(e.type===M.IncrementalSnapshot){if(e.data.source===N.Mutation&&e.data.isAttachIframe)return;_++;const t=o&&e.timestamp-L.timestamp>o;(r&&_>=r||t)&&fe(!0)}};const R=t=>{pe(he({type:M.IncrementalSnapshot,data:e({source:N.Mutation},t)}))},H=new de({mutationCb:R}),W=new me({mutationCb:R,bypassOptions:{blockClass:s,blockSelector:a,maskTextClass:l,maskTextSelector:c,inlineStylesheet:u,maskInputOptions:C,maskTextFn:f,recordCanvas:k,slimDOMOptions:T,iframeManager:H},mirror:ge});fe=(e=!1)=>{var t,n,o,r,i,d,m,h,p,g;pe(he({type:M.Meta,data:{href:window.location.href,width:P(),height:$()}}),e),ie.forEach(e=>e.lock());const[v,y]=function(e,t){const{blockClass:n="rr-block",blockSelector:o=null,maskTextClass:r="rr-mask",maskTextSelector:s=null,inlineStylesheet:a=!0,recordCanvas:i=!1,maskAllInputs:l=!1,maskTextFn:c,slimDOM:u=!1,preserveWhiteSpace:d,onSerialize:m,onIframeLoad:h,iframeLoadTimeout:p}=t||{},f={};return[O(e,{doc:e,map:f,blockClass:n,blockSelector:o,maskTextClass:r,maskTextSelector:s,skipChild:!1,inlineStylesheet:a,maskInputOptions:!0===l?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===l?{password:!0}:l,maskTextFn:c,slimDOMOptions:!0===u||"all"===u?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===u,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===u?{}:u,recordCanvas:i,preserveWhiteSpace:d,onSerialize:m,onIframeLoad:h,iframeLoadTimeout:p}),f]}(document,{blockClass:s,blockSelector:a,maskTextClass:l,maskTextSelector:c,inlineStylesheet:u,maskAllInputs:C,maskTextFn:f,slimDOM:T,recordCanvas:k,onSerialize:e=>{q(e)&&H.addIframe(e),U(e)&&W.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{H.attachIframe(e,t)}});if(!v)return console.warn("Failed to snapshot the document");ge.map=y,pe(he({type:M.FullSnapshot,data:{node:v,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null==(t=document)?void 0:t.documentElement.scrollLeft)||(null==(n=document)||null==(o=n.body)||null==(r=o.parentElement)?void 0:r.scrollLeft)||(null==(i=document)?void 0:i.body.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null==(d=document)?void 0:d.documentElement.scrollTop)||(null==(m=document)||null==(h=m.body)||null==(p=h.parentElement)?void 0:p.scrollTop)||(null==(g=document)?void 0:g.body.scrollTop)||0}}})),ie.forEach(e=>e.unlock())};try{const t=[];t.push(D("DOMContentLoaded",()=>{pe(he({type:M.DomContentLoaded,data:{}}))}));const n=t=>function(t,n={}){!function(e,t){const{mutationCb:n,mousemoveCb:o,mouseInteractionCb:r,scrollCb:s,viewportResizeCb:a,inputCb:i,mediaInteractionCb:l,styleSheetRuleCb:c,canvasMutationCb:u,fontCb:d,logCb:m}=e;e.mutationCb=(...e)=>{t.mutation&&t.mutation(...e),n(...e)},e.mousemoveCb=(...e)=>{t.mousemove&&t.mousemove(...e),o(...e)},e.mouseInteractionCb=(...e)=>{t.mouseInteraction&&t.mouseInteraction(...e),r(...e)},e.scrollCb=(...e)=>{t.scroll&&t.scroll(...e),s(...e)},e.viewportResizeCb=(...e)=>{t.viewportResize&&t.viewportResize(...e),a(...e)},e.inputCb=(...e)=>{t.input&&t.input(...e),i(...e)},e.mediaInteractionCb=(...e)=>{t.mediaInteaction&&t.mediaInteaction(...e),l(...e)},e.styleSheetRuleCb=(...e)=>{t.styleSheetRule&&t.styleSheetRule(...e),c(...e)},e.canvasMutationCb=(...e)=>{t.canvasMutation&&t.canvasMutation(...e),u(...e)},e.fontCb=(...e)=>{t.font&&t.font(...e),d(...e)},e.logCb=(...e)=>{t.log&&t.log(...e),m(...e)}}(t,n);const o=le(t.mutationCb,t.doc,t.blockClass,t.blockSelector,t.maskTextClass,t.maskTextSelector,t.inlineStylesheet,t.maskInputOptions,t.maskTextFn,t.recordCanvas,t.slimDOMOptions,t.mirror,t.iframeManager,t.shadowDomManager,t.doc),r=function(e,t,n,o){if(!1===t.mousemove)return()=>{};const r="number"==typeof t.mousemove?t.mousemove:50;let s,a=[];const i=F(t=>{const n=Date.now()-s;e(a.map(e=>(e.timeOffset-=n,e)),t),a=[],s=null},"number"==typeof t.mousemoveCallback?t.mousemoveCallback:500),l=F(e=>{const{target:t}=e,{clientX:n,clientY:r}=B(e)?e.changedTouches[0]:e;s||(s=Date.now()),a.push({x:n,y:r,id:o.getId(t),timeOffset:Date.now()-s}),i(e instanceof MouseEvent?N.MouseMove:e instanceof DragEvent?N.Drag:N.TouchMove)},r,{trailing:!1}),c=[D("mousemove",l,n),D("touchmove",l,n),D("drag",l,n)];return()=>{c.forEach(e=>e())}}(t.mousemoveCb,t.sampling,t.doc,t.mirror),s=function(e,t,n,o,r){if(!1===r.mouseInteraction)return()=>{};const s=!0===r.mouseInteraction||void 0===r.mouseInteraction?{}:r.mouseInteraction,a=[];return Object.keys(I).filter(e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==s[e]).forEach(r=>{const s=r.toLowerCase(),i=(t=>r=>{if(j(r.target,o))return;const s=B(r)?r.changedTouches[0]:r;if(!s)return;const a=n.getId(r.target),{clientX:i,clientY:l}=s;e({type:I[t],id:a,x:i,y:l})})(r);a.push(D(s,i,t))}),()=>{a.forEach(e=>e())}}(t.mouseInteractionCb,t.doc,t.mirror,t.blockClass,t.sampling),a=function(e,t,n,o,r){return D("scroll",F(r=>{if(!r.target||j(r.target,o))return;const s=n.getId(r.target);if(r.target===t){const n=t.scrollingElement||t.documentElement;e({id:s,x:n.scrollLeft,y:n.scrollTop})}else e({id:s,x:r.target.scrollLeft,y:r.target.scrollTop})},r.scroll||100))}(t.scrollCb,t.doc,t.mirror,t.blockClass,t.sampling),i=function(e){let t=-1,n=-1;return D("resize",F(()=>{const o=$(),r=P();t===o&&n===r||(e({width:Number(r),height:Number(o)}),t=o,n=r)},200),window)}(t.viewportResizeCb),l=function(t,n,o,r,s,a,i,l){function c(e){const{target:t}=e;if(!t||!t.tagName||ce.indexOf(t.tagName)<0||j(t,r))return;const o=t.type;if("password"===o||t.classList.contains(s))return;let l=t.value,c=!1;"radio"===o||"checkbox"===o?c=t.checked:(a[t.tagName.toLowerCase()]||a[o])&&(l=i?i(l):"*".repeat(l.length)),u(t,{text:l,isChecked:c});const d=t.name;"radio"===o&&d&&c&&n.querySelectorAll(`input[type="radio"][name="${d}"]`).forEach(e=>{e!==t&&u(e,{text:e.value,isChecked:!c})})}function u(n,r){const s=ue.get(n);if(!s||s.text!==r.text||s.isChecked!==r.isChecked){ue.set(n,r);const s=o.getId(n);t(e({},r,{id:s}))}}const d=("last"===l.input?["change"]:["input","change"]).map(e=>D(e,c,n)),m=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),h=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"]];return m&&m.set&&d.push(...h.map(e=>A(e[0],e[1],{set(){c({target:this})}}))),()=>{d.forEach(e=>e())}}(t.inputCb,t.doc,t.mirror,t.blockClass,t.ignoreClass,t.maskInputOptions,t.maskInputFn,t.sampling),c=function(e,t,n){const o=o=>r=>{const{target:s}=r;s&&!j(s,t)&&e({type:"play"===o?0:1,id:n.getId(s)})},r=[D("play",o("play")),D("pause",o("pause"))];return()=>{r.forEach(e=>e())}}(t.mediaInteractionCb,t.blockClass,t.mirror),u=function(e,t){const n=CSSStyleSheet.prototype.insertRule;CSSStyleSheet.prototype.insertRule=function(o,r){const s=t.getId(this.ownerNode);return-1!==s&&e({id:s,adds:[{rule:o,index:r}]}),n.apply(this,arguments)};const o=CSSStyleSheet.prototype.deleteRule;return CSSStyleSheet.prototype.deleteRule=function(n){const r=t.getId(this.ownerNode);return-1!==r&&e({id:r,removes:[{index:n}]}),o.apply(this,arguments)},()=>{CSSStyleSheet.prototype.insertRule=n,CSSStyleSheet.prototype.deleteRule=o}}(t.styleSheetRuleCb,t.mirror),d=t.recordCanvas?function(e,t,n){const o=Object.getOwnPropertyNames(CanvasRenderingContext2D.prototype),r=[];for(const s of o)try{if("function"!=typeof CanvasRenderingContext2D.prototype[s])continue;const o=z(CanvasRenderingContext2D.prototype,s,function(o){return function(...r){return j(this.canvas,t)||setTimeout(()=>{const t=[...r];"drawImage"===s&&t[0]&&t[0]instanceof HTMLCanvasElement&&(t[0]=t[0].toDataURL()),e({id:n.getId(this.canvas),property:s,args:t})},0),o.apply(this,r)}});r.push(o)}catch(t){const o=A(CanvasRenderingContext2D.prototype,s,{set(t){e({id:n.getId(this.canvas),property:s,args:[t],setter:!0})}});r.push(o)}return()=>{r.forEach(e=>e())}}(t.canvasMutationCb,t.blockClass,t.mirror):()=>{},m=t.collectFonts?function(e){const t=[],n=new WeakMap,o=FontFace;window.FontFace=function(e,t,r){const s=new o(e,t,r);return n.set(s,{family:e,buffer:"string"!=typeof t,descriptors:r,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),s};const r=z(document.fonts,"add",function(t){return function(o){return setTimeout(()=>{const t=n.get(o);t&&(e(t),n.delete(o))},0),t.apply(this,[o])}});return t.push(()=>{window.FonFace=o}),t.push(r),()=>{t.forEach(e=>e())}}(t.fontCb):()=>{},h=t.logOptions?function(e,t){const n=t.logger;if(!n)return()=>{};let o=0;const r=[];if(t.level.includes("error")&&window){const n=window.onerror;window.onerror=(o,r,s,a,i)=>{n&&n.apply(this,[o,r,s,a,i]);const l=ae.parse(i).map(e=>e.toString()),c=[te(o,t.stringifyOptions)];e({level:"error",trace:l,payload:c})},r.push(()=>{window.onerror=n})}for(const e of t.level)r.push(s(n,e));return()=>{r.forEach(e=>e())};function s(n,r){return n[r]?z(n,r,n=>(...s)=>{n.apply(this,s);try{const n=ae.parse(new Error).map(e=>e.toString()).splice(1),a=s.map(e=>te(e,t.stringifyOptions));o++,o<t.lengthThreshold?e({level:r,trace:n,payload:a}):o===t.lengthThreshold&&e({level:"warn",trace:[],payload:[te("The number of log records reached the threshold.")]})}catch(e){n("rrweb logger error:",e,...s)}}):()=>{}}}(t.logCb,t.logOptions):()=>{};return()=>{o.disconnect(),r(),s(),a(),i(),l(),c(),u(),d(),m(),h()}}({mutationCb:R,mousemoveCb:(e,t)=>pe(he({type:M.IncrementalSnapshot,data:{source:t,positions:e}})),mouseInteractionCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.MouseInteraction},t)})),scrollCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.Scroll},t)})),viewportResizeCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.ViewportResize},t)})),inputCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.Input},t)})),mediaInteractionCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.MediaInteraction},t)})),styleSheetRuleCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.StyleSheetRule},t)})),canvasMutationCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.CanvasMutation},t)})),fontCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.Font},t)})),logCb:t=>pe(he({type:M.IncrementalSnapshot,data:e({source:N.Log},t)})),blockClass:s,ignoreClass:i,maskTextClass:l,maskTextSelector:c,maskInputOptions:C,inlineStylesheet:u,sampling:y,recordCanvas:k,collectFonts:S,doc:t,maskInputFn:p,maskTextFn:f,logOptions:x,blockSelector:a,slimDOMOptions:T,mirror:ge,iframeManager:H,shadowDomManager:W},g);H.addLoadListener(e=>{t.push(n(e.contentDocument))});const o=()=>{fe(),t.push(n(document))};return"interactive"===document.readyState||"complete"===document.readyState?o():t.push(D("load",()=>{pe(he({type:M.Load,data:{}})),o()},window)),()=>{t.forEach(e=>e())}}catch(e){console.warn(e)}}let ye;ve.addCustomEvent=(e,t)=>{if(!pe)throw new Error("please add custom event after start recording");pe(he({type:M.Custom,data:{tag:e,payload:t}}))},ve.freezePage=()=>{ie.forEach(e=>e.freeze())},ve.takeFullSnapshot=e=>{if(!fe)throw new Error("please take full snapshot after start recording");fe(e)},ve.mirror=ge;try{ye=require("worker_threads").Worker}catch(e){}const be=Uint8Array,ke=Uint16Array,Se=Uint32Array,we=new be([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ce=new be([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Te=new be([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ee=(e,t)=>{const n=new ke(31);for(let o=0;o<31;++o)n[o]=t+=1<<e[o-1];const o=new Se(n[30]);for(let e=1;e<30;++e)for(let t=n[e];t<n[e+1];++t)o[t]=t-n[e]<<5|e;return[n,o]},[xe,Oe]=Ee(we,2);xe[28]=258,Oe[258]=28;const[Me,Ne]=Ee(Ce,0),Ie=new ke(32768);for(let e=0;e<32768;++e){let t=(43690&e)>>>1|(21845&e)<<1;t=(52428&t)>>>2|(13107&t)<<2,t=(61680&t)>>>4|(3855&t)<<4,Ie[e]=((65280&t)>>>8|(255&t)<<8)>>>1}const Le=(e,t,n)=>{const o=e.length;let r=0;const s=new ke(t);for(;r<o;++r)++s[e[r]-1];const a=new ke(t);for(r=0;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;let i;if(n){i=new ke(1<<t);const n=15-t;for(r=0;r<o;++r)if(e[r]){const o=r<<4|e[r],s=t-e[r];let l=a[e[r]-1]++<<s;for(const e=l|(1<<s)-1;l<=e;++l)i[Ie[l]>>>n]=o}}else for(i=new ke(o),r=0;r<o;++r)e[r]&&(i[r]=Ie[a[e[r]-1]++]>>>15-e[r]);return i},De=new be(288);for(let e=0;e<144;++e)De[e]=8;for(let e=144;e<256;++e)De[e]=9;for(let e=256;e<280;++e)De[e]=7;for(let e=280;e<288;++e)De[e]=8;const _e=new be(32);for(let e=0;e<32;++e)_e[e]=5;const Re=Le(De,9,0),Fe=Le(_e,5,0),Ae=e=>(e/8|0)+(7&e&&1),ze=(e,t,n)=>{(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);const o=new(e instanceof ke?ke:e instanceof Se?Se:be)(n-t);return o.set(e.subarray(t,n)),o},$e=(e,t,n)=>{const o=t/8|0;e[o]|=n<<=7&t,e[o+1]|=n>>>8},Pe=(e,t,n)=>{const o=t/8|0;e[o]|=n<<=7&t,e[o+1]|=n>>>8,e[o+2]|=n>>>16},je=(e,t)=>{const n=[];for(let t=0;t<e.length;++t)e[t]&&n.push({s:t,f:e[t]});const o=n.length,r=n.slice();if(!o)return[Je,0];if(1==o){const e=new be(n[0].s+1);return e[n[0].s]=1,[e,1]}n.sort((e,t)=>e.f-t.f),n.push({s:-1,f:25001});let s=n[0],a=n[1],i=0,l=1,c=2;for(n[0]={s:-1,f:s.f+a.f,l:s,r:a};l!=o-1;)s=n[n[i].f<n[c].f?i++:c++],a=n[i!=l&&n[i].f<n[c].f?i++:c++],n[l++]={s:-1,f:s.f+a.f,l:s,r:a};let u=r[0].s;for(let e=1;e<o;++e)r[e].s>u&&(u=r[e].s);const d=new ke(u+1);let m=He(n[l-1],d,0);if(m>t){let e=0,n=0;const s=m-t,a=1<<s;for(r.sort((e,t)=>d[t.s]-d[e.s]||e.f-t.f);e<o;++e){const o=r[e].s;if(!(d[o]>t))break;n+=a-(1<<m-d[o]),d[o]=t}for(n>>>=s;n>0;){const o=r[e].s;d[o]<t?n-=1<<t-d[o]++-1:++e}for(;e>=0&&n;--e){const o=r[e].s;d[o]==t&&(--d[o],++n)}m=t}return[new be(d),m]},He=(e,t,n)=>-1==e.s?Math.max(He(e.l,t,n+1),He(e.r,t,n+1)):t[e.s]=n,We=e=>{let t=e.length;for(;t&&!e[--t];);const n=new ke(++t);let o=0,r=e[0],s=1;const a=e=>{n[o++]=e};for(let n=1;n<=t;++n)if(e[n]==r&&n!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(r),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(r);s=1,r=e[n]}return[n.subarray(0,o),t]},Be=(e,t)=>{let n=0;for(let o=0;o<t.length;++o)n+=e[o]*t[o];return n},qe=(e,t,n)=>{const o=n.length,r=Ae(t+2);e[r]=255&o,e[r+1]=o>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(let t=0;t<o;++t)e[r+t+4]=n[t];return 8*(r+4+o)},Ue=(e,t,n,o,r,s,a,i,l,c,u)=>{$e(t,u++,n),++r[256];const[d,m]=je(r,15),[h,p]=je(s,15),[f,g]=We(d),[v,y]=We(h),b=new ke(19);for(let e=0;e<f.length;++e)b[31&f[e]]++;for(let e=0;e<v.length;++e)b[31&v[e]]++;const[k,S]=je(b,7);let w=19;for(;w>4&&!k[Te[w-1]];--w);const C=c+5<<3,T=Be(r,De)+Be(s,_e)+a,E=Be(r,d)+Be(s,h)+a+14+3*w+Be(b,k)+(2*b[16]+3*b[17]+7*b[18]);if(C<=T&&C<=E)return qe(t,u,e.subarray(l,l+c));let x,O,M,N;if($e(t,u,1+(E<T)),u+=2,E<T){x=Le(d,m,0),O=d,M=Le(h,p,0),N=h;const e=Le(k,S,0);$e(t,u,g-257),$e(t,u+5,y-1),$e(t,u+10,w-4),u+=14;for(let e=0;e<w;++e)$e(t,u+3*e,k[Te[e]]);u+=3*w;const n=[f,v];for(let o=0;o<2;++o){const r=n[o];for(let n=0;n<r.length;++n){const o=31&r[n];$e(t,u,e[o]),u+=k[o],o>15&&($e(t,u,r[n]>>>5&127),u+=r[n]>>>12)}}}else x=Re,O=De,M=Fe,N=_e;for(let e=0;e<i;++e)if(o[e]>255){const n=o[e]>>>18&31;Pe(t,u,x[n+257]),u+=O[n+257],n>7&&($e(t,u,o[e]>>>23&31),u+=we[n]);const r=31&o[e];Pe(t,u,M[r]),u+=N[r],r>3&&(Pe(t,u,o[e]>>>5&8191),u+=Ce[r])}else Pe(t,u,x[o[e]]),u+=O[o[e]];return Pe(t,u,x[256]),u+O[256]},Ve=new Se([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Je=new be(0),Xe="undefined"!=typeof TextEncoder&&new TextEncoder,Ye="undefined"!=typeof TextDecoder&&new TextDecoder;let Ge=0;try{Ye.decode(Je,{stream:!0}),Ge=1}catch(e){}const Ke=t=>{const n=e({},t,{v:"v1"});return function(e,t){{let t="";for(let n=0;n<e.length;n+=16384)t+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return t}}(function(e,t){t||(t={});const n=(()=>{let e=1,t=0;return{p(n){let o=e,r=t;const s=0|n.length;for(let e=0;e!=s;){const t=Math.min(e+2655,s);for(;e<t;++e)r+=o+=n[e];o=(65535&o)+15*(o>>16),r=(65535&r)+15*(r>>16)}e=o,t=r},d:()=>(e%=65521,t%=65521,(255&e)<<24|e>>>8<<16|(255&t)<<8|t>>>8)}})();n.p(e);const o=((e,t,n,o,r,s)=>{const a=e.length,i=new be(2+a+5*(1+Math.ceil(a/7e3))+4),l=i.subarray(2,i.length-4);let c=0;if(!t||a<8)for(let t=0;t<=a;t+=65535){const n=t+65535;n<a?c=qe(l,c,e.subarray(t,n)):(l[t]=!0,c=qe(l,c,e.subarray(t,a)))}else{const o=Ve[t-1],r=o>>>13,s=8191&o,i=(1<<n)-1,u=new ke(32768),d=new ke(i+1),m=Math.ceil(n/3),h=2*m,p=t=>(e[t]^e[t+1]<<m^e[t+2]<<h)&i,f=new Se(25e3),g=new ke(288),v=new ke(32);let y=0,b=0,k=0,S=0,w=0,C=0;for(;k<a;++k){const t=p(k);let n=32767&k,o=d[t];if(u[n]=o,d[t]=n,w<=k){const i=a-k;if((y>7e3||S>24576)&&i>423){c=Ue(e,l,0,f,g,v,b,S,C,k-C,c),S=y=b=0,C=k;for(let e=0;e<286;++e)g[e]=0;for(let e=0;e<30;++e)v[e]=0}let d=2,m=0,h=s,T=n-o&32767;if(i>2&&t==p(k-T)){const t=Math.min(r,i)-1,s=Math.min(32767,k),a=Math.min(258,i);for(;T<=s&&--h&&n!=o;){if(e[k+d]==e[k+d-T]){let n=0;for(;n<a&&e[k+n]==e[k+n-T];++n);if(n>d){if(d=n,m=T,n>t)break;const e=Math.min(T,n-2);let r=0;for(let t=0;t<e;++t){const e=k-T+t+32768&32767,n=e-u[e]+32768&32767;n>r&&(r=n,o=e)}}}n=o,o=u[n],T+=n-o+32768&32767}}if(m){f[S++]=268435456|Oe[d]<<18|Ne[m];const e=31&Oe[d],t=31&Ne[m];b+=we[e]+Ce[t],++g[257+e],++v[t],w=k+d,++y}else f[S++]=e[k],++g[e[k]]}}c=Ue(e,l,!0,f,g,v,b,S,C,k-C,c)}return ze(i,0,2+Ae(c)+4)})(r=e,null==(s=t).level?6:s.level,null==s.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(r.length)))):12+s.mem);var r,s;return((e,t)=>{const n=t.level,o=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=o<<6|(o?32-2*o:1)})(o,t),((e,t,n)=>{for(;n;++t)e[t]=n,n>>>=8})(o,o.length-4,n.d()),o}(function(e,t){if(Xe)return Xe.encode(e);const n=e.length;let o=new be(e.length+(e.length>>1)),r=0;const s=e=>{o[r++]=e};for(let t=0;t<n;++t){if(r+5>o.length){const e=new be(r+8+(n-t<<1));e.set(o),o=e}let a=e.charCodeAt(t);a<128?s(a):a<2048?(s(192|a>>6),s(128|63&a)):a>55295&&a<57344?(a=65536+(1047552&a)|1023&e.charCodeAt(++t),s(240|a>>18),s(128|a>>12&63),s(128|a>>6&63),s(128|63&a)):(s(224|a>>12),s(128|a>>6&63),s(128|63&a))}return ze(o,0,r)}(JSON.stringify(n))))};class Ze{constructor(){this.eventsMatrix=[[]],this.globalErrorTrace(),this.networkErrorTrace(),this.promiseErrorTrace(),this.iframeErrorTrace(),ve(e({},c.recordOptions,{emit:(e,t)=>{t&&this.eventsMatrix.push([]),this.eventsMatrix[this.eventsMatrix.length-1].push(e)},recordLog:!1,checkoutEveryNth:10,packFn:Ke}))}static getInstance(){return this.instance||(this.instance=new Ze),this.instance}globalErrorTrace(){n.onerror=(e,n,o,r,s)=>{l({source:n,lineno:o,colno:r,error:s});const a=this.eventsMatrix.length;if(c.errEventRoute&&a>=2){var i;const e=this.eventsMatrix[a-2].concat(this.eventsMatrix[a-1]);null==(i=c.reportData)||i.fetch(t.IDLE,JSON.stringify({events:e}),c.errEventRoute)}var u;return c.errLogRoute&&(null==(u=c.reportData)||u.fetch(t.IDLE,JSON.stringify({source:n,lineno:o,colno:r,error:JSON.stringify({message:null==s?void 0:s.message,stack:null==s?void 0:s.stack,name:null==s?void 0:s.name})}),c.errLogRoute)),!0}}networkErrorTrace(){n.addEventListener("error",e=>{e.target!==n&&l(e.target)},!0)}promiseErrorTrace(){window.addEventListener("unhandledrejection",e=>(e.preventDefault(),l(e.reason),!0))}iframeErrorTrace(){const e=n.frames;for(let t=0;t<e.length;t++)e[t].addEventListener("error",e=>{l(e)},!0),e[t].addEventListener("unhandledrejection",e=>{l(e)},!0)}}Ze.instance=null;class Qe{fetch(e,o,s){switch(s=c.fetchDomain+s,e){case t.URGENT:if(n.fetch)fetch(s,{body:o,method:"POST",keepalive:!0});else{let e=new XMLHttpRequest;e.open("post",s,!0),e.setRequestHeader("Content-Type","application/json"),e.send(o),e.onload=()=>e=null}return;default:if(r.sendBeacon)navigator.sendBeacon(s,o);else{let e=new Image;e.src=`${s}?body=${o}`,e.onload=()=>e=null}}}}const et=()=>o&&!!o.getEntriesByType&&!!o.now&&!!o.mark,tt=e=>parseFloat((e/Math.pow(1024,2)).toFixed(2)),nt=e=>parseFloat(e.toFixed(2)),ot=e=>{"requestIdleCallback"in n?n.requestIdleCallback(e,{timeout:3e3}):e()},rt=async()=>{const{quota:e,usage:t,usageDetails:n}=await r.storage.estimate();let o={quota:tt(e||0),usage:tt(t||0),usageDetails:n};return o.usageDetails&&Object.keys(o.usageDetails||{}).forEach(e=>o.usageDetails[e]=tt(o.usageDetails[e])),o};let st="4g",at=!1;const it=async()=>new Promise(e=>{let t={};"connection"in r&&(t.connection={downlink:r.connection.downlink,effectiveType:r.connection.effectiveType,rtt:r.connection.rtt,saveData:r.connection.saveData},at=t.connection.saveData||at,st=t.connection.effectiveType||st),"fetch"in window&&ot(async()=>{let n=[];const o=[0,0,0,50,100],r=o.map(e=>()=>new Promise(async t=>{await fetch(`http://performance-monitoring.zhourengui.top/performance-monitoring/doppler-velocity?size=${e}`),t(!0)}));for(n.push(+new Date);r.length;){const e=r.shift();await(null==e?void 0:e()),n.push(+new Date)}t.connection.bandwidth=`${((o[4]-o[3])/((n[5]-n[4])/1e3)).toFixed(2)} k/s`,e(t)}),t.userAgent=r.userAgent}),lt=async()=>{let e={};if(et()){const t=o.getEntriesByType("navigation")[0];if(t){const n=t.responseEnd,o=t.responseStart,r=t.requestStart;e={fetchTime:n-t.fetchStart,workerTime:n-t.workerStart,networkTime:n-r,downloadTime:n-o,timeToFirstByte:o-r,headerSize:t.decodedBodySize-t.transferSize||0,dnsLookupTime:t.domainLookupStart-t.domainLookupEnd,tcpTime:t.connectStart-t.connectEnd||0,firstPaintTime:n-o||0,domParseTime:t.domComplete-t.domInteractive,domRenderTime:t.domContentLoadedEventEnd-t.domContentLoadedEventStart||0,onloadTime:t.loadEventEnd-t.loadEventStart}}}return e},ct=()=>r.deviceMemory<=4||r.hardwareConcurrency<=4,ut=(e,t)=>!!["slow-2g","2g","3g"].includes(e)||ct()||t,dt=()=>{var e;if(r)return{deviceMemory:r.deviceMemory||0,hardwareConcurrency:r.hardwareConcurrency||0,serviceWorkerStatus:"serviceWorker"in r?null!=(e=r.serviceWorker)&&e.controller?"controlled":"supported":"unsupported",isLowEndDevice:ct(),isLowEndExperience:ut(st,at)}},mt=[1e3,2500],ht=[2500,4e3],pt=[100,300],ft=[.1,.25],gt=[300,600],vt={fp:mt,fcp:mt,lcp:ht,lcpFinal:ht,fid:pt,fidVitals:pt,cls:ft,clsFinal:ft,tbt:gt,tbt5S:gt,tbt10S:gt,tbtFinal:gt},yt=(e,t)=>vt[e]?t<=vt[e][0]?"good":t<=vt[e][1]?"needsImprovement":"poor":null,bt=(e,t,n)=>{ot(()=>{("hidden"!==a.visibilityState||t.includes("Final"))&&c.analyticsTracker&&c.analyticsTracker({metricName:t,data:e,eventProperties:n,navigatorInformation:dt(),vitalsScore:yt(t,e)})})},kt=(e,t,n)=>{Object.keys(t).forEach(e=>{"number"==typeof t[e]&&(t[e]=nt(t[e]))}),bt(t,e,n)},St=(e,t,n)=>{nt(t)<=c.maxTime&&bt(t,e,n)},wt={value:0},Ct={value:0},Tt={value:0},Et={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},xt={value:0},Ot=e=>{const t=e.pop();t&&(Tt.value=t.renderTime||t.startTime)},Mt=e=>{for(let t=0;t<e.length;t++){const n=e[t];n.identifier&&St(n.identifier,n.startTime,{performanceEntry:n})}},Nt=e=>{for(let t=0;t<e.length;t++){const n=e[t];if("self"!==n.name&&n.startTime<wt.value)return;n.startTime-50>0&&(Ct.value+=n.startTime,St("longtask",n.startTime))}},It=e=>{const t=e.pop();t&&(St("fidVitals",t.processingStart-t.startTime,{performanceEntry:t}),St("fid",t.duration,{performanceEntry:t})),Ft("first-input"),St("lcp",Tt.value),_t["layout-shift"]&&"function"==typeof _t["layout-shift"].takeRecords&&_t["layout-shift"].takeRecords(),St("cls",xt.value),St("bt",Ct.value),setTimeout(()=>{St("bt5S",Ct.value)},5e3),setTimeout(()=>{St("bt10S",Ct.value),kt("dataConsumption",Et.value)},1e4)},Lt=e=>{for(let t=0;t<e.length;t++){const n=e[t];if(kt("resourceTiming",n),n.decodedBodySize&&n.initiatorType){const e=n.decodedBodySize/1e3;Et.value[n.initiatorType]+=e,Et.value.total+=e}}},Dt=e=>{const t=e.pop();t&&!t.hadRecentInput&&t.value&&(xt.value+=t.value)},_t={},Rt=(e,t)=>{try{const n=new PerformanceObserver(e=>t(e.getEntries()));return n.observe({type:e,buffered:!0}),n}catch(e){s.warn("PerformanceMonitoring obseverðŸŒ²:",`mini-pm: ${e}`)}return null},Ft=e=>{var t;_t[e]&&(null==(t=_t[e])||t.disconnect()),delete _t[e]},At=()=>{_t["largest-contentful-paint"]&&(St("lcpFinal",Tt.value),Ft("largest-contentful-paint")),_t["layout-shift"]&&("function"==typeof _t["layout-shift"].takeRecords&&_t["layout-shift"].takeRecords(),St("clsFinal",xt.value),Ft("layout-shift")),_t.longtask&&(St("btFinal",Ct.value),Ft("longtask"))};export default class{constructor(e={}){const{isObserverElementTiming:n,isObserverResourceTiming:o,maxTime:r,captureError:s,fetchDomain:l,errLogRoute:u,errEventRoute:d,logRoute:m,analyticsTracker:h,recordOptions:p}=e;var f;c.isObserverElementTiming=!!n,c.isObserverResourceTiming=!!o,c.maxTime=r||c.maxTime,c.captureError=s||c.captureError,c.fetchDomain=l,c.errLogRoute=u,c.errEventRoute=d,c.logRoute=m,c.reportData=new Qe,c.analyticsTracker=h||c.analyticsTracker,c.recordOptions=p||c.recordOptions,i("1.0.0"),s&&l&&Ze.getInstance(),et()&&("hidden"===a.visibilityState&&a.addEventListener("visibilitychange",At),l&&m&&Promise.all([lt(),it(),rt()]).then(e=>{var n;null==(n=c.reportData)||n.fetch(t.IDLE,JSON.stringify(e),m)}),_t.paint=Rt("paint",(f=()=>_t.longtask=Rt("longtask",Nt),e=>{for(let t=0;t<e.length;t++){const n=e[t];"first-paint"===n.name?St("fp",n.startTime):"first-contentful-paint"===n.name&&(wt.value=n.startTime,St("fcp",n.startTime),f(),Ft("paint"))}})),_t["first-input"]=Rt("first-input",It),_t["largest-contentful-paint"]=Rt("largest-contentful-paint",Ot),c.isObserverResourceTiming&&Rt("resource",Lt),_t["layout-shift"]=Rt("layout-shift",Dt),c.isObserverElementTiming&&Rt("element",Mt))}}
//# sourceMappingURL=mini-pm.modern.js.map
