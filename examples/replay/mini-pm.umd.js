!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("rrweb")):"function"==typeof define&&define.amd?define(["rrweb"],n):(e||self).miniPm=n(e.rrweb)}(this,function(e){var n=window,t=n.performance,r=n.navigator,o=function(){return t&&!!t.getEntriesByType&&!!t.now&&!!t.mark},i=function(e){return parseFloat((e/Math.pow(1024,2)).toFixed(2))},a={isObserverResourceTiming:!1,isObserverElementTiming:!1,lookbackTime:15e3,captureError:!0,reportData:null};function c(e,n,t){if(!e.s){if(t instanceof u){if(!t.s)return void(t.o=c.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(c.bind(null,e,n),c.bind(null,e,2));e.s=n,e.v=t;var r=e.o;r&&r(e)}}var s,u=function(){function e(){}return e.prototype.then=function(n,t){var r=new e,o=this.s;if(o){var i=1&o?n:t;if(i){try{c(r,1,i(this.v))}catch(e){c(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?c(r,1,n?n(o):o):t?c(r,1,t(o)):c(r,2,o)}catch(e){c(r,2,e)}},r},e}();function l(e){return e instanceof u&&1&e.s}!function(e){e[e.URGENT=1]="URGENT",e[e.IDLE=2]="IDLE"}(s||(s={}));var f=function(){function t(){var n=this;this.eventsMatrix=[[]],e.record({emit:function(e,t){t&&n.eventsMatrix.push([]),n.eventsMatrix[n.eventsMatrix.length-1].push(e)},recordLog:!0,checkoutEveryNth:10,packFn:e.pack}),setTimeout(function(){n.globalErrorTrace(),n.networkErrorTrace(),n.promiseErrorTrace(),n.iframeErrorTrace()},100)}t.getInstance=function(){return this.instance||(this.instance=new t),this.instance};var r=t.prototype;return r.globalErrorTrace=function(){var e=this;n.onerror=function(n,t,r,o,i){if(console.log("❌全局捕获错误",{source:t,lineno:r,colno:o,error:i}),a.errEventRoute){var c,u=e.eventsMatrix.length,l=e.eventsMatrix[u-2].concat(e.eventsMatrix[u-1]);null==(c=a.reportData)||c.errTraceback(s.IDLE,JSON.stringify({events:l}),a.errEventRoute)}var f;return a.errLogRoute&&(null==(f=a.reportData)||f.errTraceback(s.IDLE,JSON.stringify({source:t,lineno:r,colno:o,error:JSON.stringify({message:null==i?void 0:i.message,stack:null==i?void 0:i.stack,name:null==i?void 0:i.name})}),a.errLogRoute)),!0}},r.networkErrorTrace=function(){n.addEventListener("error",function(e){e.target!==n&&console.log("❌捕获网络错误",e.target)},!0)},r.promiseErrorTrace=function(){window.addEventListener("unhandledrejection",function(e){return e.preventDefault(),console.log("❌捕获promise错误",e.reason),!0})},r.iframeErrorTrace=function(){for(var e=n.frames,t=0;t<e.length;t++)e[t].addEventListener("error",function(e){console.log("❌捕获iframe错误",e)},!0),e[t].addEventListener("unhandledrejection",function(e){console.log("❌捕获iframe unhandledrejection错误",e)},!0)},t}();f.instance=null;var v=function(){function e(e){this.logDomain=e.logDomain}return e.prototype.errTraceback=function(e,t,o){switch(o=this.logDomain+o,e){case s.URGENT:if(n.fetch)fetch(o,{body:t,method:"POST",keepalive:!0});else{var i=new XMLHttpRequest;i.open("post",o,!0),i.setRequestHeader("Content-Type","application/json"),i.send(t),i.onload=function(){return i=null}}return;default:if(r.sendBeacon)navigator.sendBeacon(o,t);else{var a=new Image;a.src=o+"?body="+t,a.onload=function(){return a=null}}}},e}();return function(e){var n=this;void 0===e&&(e={}),this.timing=null,this.navigator=null,this.storage=null;var s=e.isObserverResourceTiming,d=e.lookbackTime,h=e.captureError,m=e.logDomain,g=e.errLogRoute,p=e.errEventRoute;a.isObserverElementTiming=!!e.isObserverElementTiming,a.isObserverResourceTiming=!!s,a.lookbackTime=d||a.lookbackTime,a.captureError=h||a.captureError,a.logDomain=m,a.errLogRoute=g,a.errEventRoute=p,a.reportData=new v({logDomain:m}),console.log("PerformanceMonitoring Version🍎：1.0.0"),a.captureError&&m&&f.getInstance(),o()&&(function(){try{var e={};if(o()){var n=t.getEntriesByType("navigation")[0];if(n){var r=n.responseEnd,i=n.responseStart,a=n.requestStart;e={fetchTime:r-n.fetchStart,workerTime:r-n.workerStart,networkTime:r-a,downloadTime:r-i,timeToFirstByte:i-a,headerSize:n.decodedBodySize-n.transferSize||0,dnsLookupTime:n.domainLookupStart-n.domainLookupEnd,tcpTime:n.connectStart-n.connectEnd||0,firstPaintTime:r-i||0,domParseTime:n.domComplete-n.domInteractive,domRenderTime:n.domContentLoadedEventEnd-n.domContentLoadedEventStart||0,onloadTime:n.loadEventEnd-n.loadEventStart}}}return Promise.resolve(e)}catch(e){return Promise.reject(e)}}().then(function(e){n.timing=e,console.log("timing🍎",n.timing)}),function(){try{var e=function(){return n.userAgent=r.userAgent,n},n={};"connection"in r&&(n.connection=r.connection);var t=function(){if("fetch"in window){var e=function(){n.connection.bandwidth=((r[4]-r[3])/((t[5]-t[4])/1e3)).toFixed(2)+" k/s"},t=[],r=[0,0,0,50,100],o=r.map(function(e){return function(){return new Promise(function(n){try{return Promise.resolve(fetch("http://106.12.49.47:1234/doppler-velocity?size="+e)).then(function(){n(!0)})}catch(e){return Promise.reject(e)}})}});t.push(+new Date);var i=function(e,n,t){for(var r;;){var o=e();if(l(o)&&(o=o.v),!o)return i;if(o.then){r=0;break}var i=t();if(i&&i.then){if(!l(i)){r=1;break}i=i.s}}var a=new u,s=c.bind(null,a,2);return(0===r?o.then(v):1===r?i.then(f):(void 0).then(function(){(o=e())?o.then?o.then(v).then(void 0,s):v(o):c(a,1,i)})).then(void 0,s),a;function f(n){i=n;do{if(!(o=e())||l(o)&&!o.v)return void c(a,1,i);if(o.then)return void o.then(v).then(void 0,s);l(i=t())&&(i=i.v)}while(!i||!i.then);i.then(f).then(void 0,s)}function v(e){e?(i=t())&&i.then?i.then(f).then(void 0,s):f(i):c(a,1,i)}}(function(){return!!o.length},0,function(){var e=o.shift();return Promise.resolve(null==e?void 0:e()).then(function(){t.push(+new Date)})});return i&&i.then?i.then(e):e()}}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(e){return Promise.reject(e)}}().then(function(e){n.navigator=e,console.log("navigator🍎",n.navigator)}),function(){try{return Promise.resolve(r.storage.estimate()).then(function(e){var n=e.usage,t=e.usageDetails,r={quota:i(e.quota||0),usage:i(n||0),usageDetails:t};return r.usageDetails&&Object.keys(r.usageDetails||{}).forEach(function(e){return r.usageDetails[e]=i(r.usageDetails[e])}),r})}catch(e){return Promise.reject(e)}}().then(function(e){n.storage=e,console.log("storage🍎",n.storage)}))}});
//# sourceMappingURL=mini-pm.umd.js.map
